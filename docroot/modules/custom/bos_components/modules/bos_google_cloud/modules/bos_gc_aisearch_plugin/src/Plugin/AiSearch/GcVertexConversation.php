<?php

namespace Drupal\bos_gc_aisearch_plugin\Plugin\AiSearch;

use Drupal\bos_search\AiSearchBase;
use Drupal\bos_search\AiSearchInterface;
use Drupal\bos_search\Model\AiSearchCitation;
use Drupal\bos_search\Model\AiSearchRequest;
use Drupal\bos_search\Model\AiSearchResponse;
use Drupal\bos_search\Model\AiSearchResult;
use Drupal\bos_search\Annotation\AiSearchAnnotation;

/**
 * Provides an 'AiSearch' plugin for bos_google_cloud.
 *
 * @AiSearchAnnotation (
 *   id = "Vertex Conversation",
 *   service = "bos_google_cloud.GcConversation",
 *   description = "Plugin for Google Cloud Vertex Conversation Service"
 * )
 */
class GcVertexConversation extends AiSearchBase implements AiSearchInterface {

  private const NO_RESULTS = "No Results";

  /**
   * @inheritDoc
   */
  public function search(AiSearchRequest $request, bool $fake = FALSE): AiSearchResponse {
    try {
      // Ask the search question to Vertex.
      $preset = $request->get("preset") ?? [];
      if ($fake) {
        $result = $this->fakeResponse();
        if (empty($request->get("session_id"))) {
          $result["session_id"] = rand(10000000,99999999);
        }
        else {
          $result["session_id"] = $request->get("session_id");
        }
      }
      else {
        $parameters = [
          "text" => $request->get("search_text") ?? "",
          "allow_conversation" => $preset["searchform"]["searchbar"]["allow_conversation"] ?? FALSE,
          "session_id" => $request->get("session_id") ?? "",
          "prompt" => $preset["prompt"] ?? 'default',
          "extra_prompt" => 'If you cannot understand the question or the question cannot be answered, respond with the text "' . self::NO_RESULTS . '"',
          "metadata" => $preset["results"]["metadata"] ?? 0,
          "num_results" => $preset["results"]["result_count"] ?? 0,
          "include_citations" => $preset["results"]["citations"] ?? 0,
          "safe_search" => $preset["model_tuning"]['search']["safe_search"] ?? 0,
          "ignoreAdversarialQuery" => $preset["model_tuning"]['summary']["ignoreAdversarialQuery"] ?? 0,
          "ignoreNonSummarySeekingQuery" => $preset["model_tuning"]['summary']["ignoreNonSummarySeekingQuery"] ?? 0,
          "ignoreLowRelevantContent" => $preset["model_tuning"]['summary']["ignoreLowRelevantContent"] ?? 0,
          "ignoreJailBreakingQuery" => $preset["model_tuning"]['summary']["ignoreJailBreakingQuery"] ?? 0,
          "semantic_chunks" => $preset["model_tuning"]['summary']["semantic_chunks"] ?? 0,
        ];
        // Apply any service overrides.
        if (!empty($preset["model_tuning"]["overrides"]["service_account"]) && $preset["model_tuning"]["overrides"]["service_account"] != "default") {
          $parameters["service_account"] = $preset["model_tuning"]["overrides"]["service_account"];
          $this->service->setServiceAccount($parameters["service_account"]);
        }
        if (!empty($preset["model_tuning"]["overrides"]["project_id"]) && $preset["model_tuning"]["overrides"]["project_id"] != "default") {
          $parameters["project_id"] = $preset["model_tuning"]["overrides"]["project_id"];
        }
        if (!empty($preset["model_tuning"]["overrides"]["datastore_id"]) && $preset["model_tuning"]["overrides"]["datastore_id"] != "default") {
          $parameters["datastore_id"] = $preset["model_tuning"]["overrides"]["datastore_id"];
        }
        $this->service->execute($parameters);
        $result = $this->service->getResults();
      }
    }
    catch (\Exception $e) {
      $result = FALSE;
    }

    // Load the GcSearchConversationResponse into the AiSearchResponse fmt.
    if ($result) {

      // Check for no-results response.
      $response = new AiSearchResponse($request, $result['body'], $result['session_id'] ?? "");
      if (trim($result['body']) == self::NO_RESULTS) {
        $response->set("no_results", TRUE);
        $response->set("metadata", $this->flattenMetadata($result["metadata"], $preset));
      }
      elseif (!empty($result['violations'])) {
        $response->set("violations", $result['violations']);
        $response->set("metadata", $this->flattenMetadata($result["metadata"]));
      }
      else {
        $response->set("body", $result['body'])
          ->set("metadata", $this->flattenMetadata($result["metadata"], $preset));
//          ->set("citations", $result['citations'] ?? []);
        foreach ($result['search_results'] as $search_result) {

          if (!$preset["results"]["no_dup_citations"] || !$search_result["is_citation"]) {
            // Load each search result into the AiSearchResult format.
            $res = new AiSearchResult($search_result["title"], $search_result["link"], $search_result["snippet"]);
            $res->set("id", $search_result["id"])
              ->set("link_title", $search_result["link_title"])
              ->set("content", $search_result["content"])
              ->set("description", $search_result["description"] ?? "")
              ->set("ref", $search_result["ref"]);
            $response->addResult($res);
          }
        }
        $response->set("search", $request);
      }
    }

    return $response;
  }

  /**
   * @inheritDoc
   */
  public function hasFollowUp(): bool {
    return $this->service->hasFollowup();
  }

  /**
   * Generates a fake response for testing purposes.
   *
   * This method creates a simulated response to be used when the actual response
   * from an external source is not available or when testing functionalities
   * without making real external requests.
   *
   * @return array An associative array representing a fake response, including
   *               necessary fields such as 'session_id' and other relevant
   *               placeholders required by the system.
   */
  private function fakeResponse() {
    $a = base64_decode("YTo2OntzOjQ6ImJvZHkiO3M6OTExOiIqKiBDQUNIRUQgKiogVG8gZ2V0IGEgZm9vZCB0cnVjayBwZXJtaXQgaW4gQm9zdG9uLCB5b3UnbGwgbmVlZCBzZXZlcmFsIGRvY3VtZW50cywgaW5jbHVkaW5nIHBlcm1pdHMgZnJvbSBJbnNwZWN0aW9uYWwgU2VydmljZXMgYW5kIEZpcmUsIGEgSGF3a2VyIGFuZCBQZWRkbGVyIExpY2Vuc2UsIGEgQnVzaW5lc3MgQ2VydGlmaWNhdGUsIGEgQ2VydGlmaWNhdGUgb2YgTGlhYmlsaXR5IEluc3VyYW5jZSwgYSBidXNpbmVzcyBwbGFuLCBhbmQgYSB3cml0dGVuIGFncmVlbWVudCBmcm9tIHlvdXIgY29tbWlzc2FyeS4gWzFdIFlvdSdsbCBhbHNvIG5lZWQgYSBmaXJlIHN1cHByZXNzaW9uIHN5c3RlbSBhbmQgYSBmaXJlIGV4dGluZ3Vpc2hlciBmb3IgeW91ciB0cnVjay4gWzJdIE9uY2UgeW91ciB0cnVjayBwYXNzZXMgdGhlIGZpcmUgaW5zcGVjdGlvbiwgdGhlIGZpcmUgaW5zcGVjdG9yIHdpbGwgc2lnbiB5b3VyIGZvb2QgdHJ1Y2sgcGVybWl0IGFwcGxpY2F0aW9uLiBbMl0gIFlvdSdsbCBuZWVkIHRvIGdldCBwZXJtaXNzaW9uIGZyb20gdGhlIHByb3BlcnR5IG93bmVyIGlmIHlvdSBwbGFuIHRvIG9wZXJhdGUgaW4gYSBwcml2YXRlIGxvY2F0aW9uLiBbMV0gIEZpbmFsbHksIHlvdSdsbCBuZWVkIHRvIHN1Ym1pdCB5b3VyIGZvb2QgdHJ1Y2sgcGVybWl0IGFwcGxpY2F0aW9uLCBhIGxlYXNlIG9yIGxldHRlciBvZiBhZ3JlZW1lbnQgZnJvbSB0aGUgcHJvcGVydHkgb3duZXIsIGEgcGhvdG8gb2YgdGhlIHNpdGUsIGEgZHJhd2luZyBzaG93aW5nIHdoZXJlIHlvdXIgdHJ1Y2sgd2lsbCBiZSBsb2NhdGVkIGFuZCBob3cgeW91IHBsYW4gdG8gc2VydmUgZm9vZCwgYW5kIGEgY29weSBvZiB5b3VyIFVzZSBvZiBQcmVtaXNlcyBwZXJtaXQgYXBwcm92ZWQgYnkgSW5zcGVjdGlvbmFsIFNlcnZpY2VzLiBbNV0gCiI7czo4OiJtZXRhZGF0YSI7YTo0OntzOjc6IlJlcXVlc3QiO2E6ODp7czo0OiJUZXh0IjthOjI6e3M6Mzoia2V5IjtzOjQ6InRleHQiO3M6NToidmFsdWUiO3M6MzM6IkhvdyBkbyBJIGdldCBhIGZvb2QgdHJ1Y2sgcGVybWl0PyI7fXM6NjoiUHJvbXB0IjthOjI6e3M6Mzoia2V5IjtzOjY6InByb21wdCI7czo1OiJ2YWx1ZSI7czo4OiJhaVNlYXJjaCI7fXM6ODoiTWV0YWRhdGEiO2E6Mjp7czozOiJrZXkiO3M6ODoibWV0YWRhdGEiO3M6NToidmFsdWUiO3M6MToiMSI7fXM6MTE6Ik51bSBSZXN1bHRzIjthOjI6e3M6Mzoia2V5IjtzOjExOiJudW1fcmVzdWx0cyI7czo1OiJ2YWx1ZSI7czoxOiI1Ijt9czoxNzoiSW5jbHVkZSBDaXRhdGlvbnMiO2E6Mjp7czozOiJrZXkiO3M6MTc6ImluY2x1ZGVfY2l0YXRpb25zIjtzOjU6InZhbHVlIjtzOjE6IjEiO31zOjExOiJTYWZlIFNlYXJjaCI7YToyOntzOjM6ImtleSI7czoxMToic2FmZV9zZWFyY2giO3M6NToidmFsdWUiO3M6MToiMSI7fXM6MTU6IlNlbWFudGljIENodW5rcyI7YToyOntzOjM6ImtleSI7czoxNToic2VtYW50aWNfY2h1bmtzIjtzOjU6InZhbHVlIjtpOjA7fXM6NToiTW9kZWwiO2E6Mjp7czozOiJrZXkiO3M6NToibW9kZWwiO3M6NToidmFsdWUiO3M6Njoic3RhYmxlIjt9fXM6MTI6Ik1vZGVsIENvbmZpZyI7YTo2OntzOjEwOiJQcm9qZWN0IElkIjthOjI6e3M6Mzoia2V5IjtzOjEwOiJwcm9qZWN0X2lkIjtzOjU6InZhbHVlIjtzOjEyOiI2MTIwNDI2MTI1ODgiO31zOjEyOiJEYXRhc3RvcmUgSWQiO2E6Mjp7czozOiJrZXkiO3M6MTI6ImRhdGFzdG9yZV9pZCI7czo1OiJ2YWx1ZSI7czoyNzoiZHJ1cGFsd2Vic2l0ZV8xNzAyOTE5MTE5NzY4Ijt9czoxMToiTG9jYXRpb24gSWQiO2E6Mjp7czozOiJrZXkiO3M6MTE6ImxvY2F0aW9uX2lkIjtzOjU6InZhbHVlIjtzOjY6Imdsb2JhbCI7fXM6ODoiRW5kcG9pbnQiO2E6Mjp7czozOiJrZXkiO3M6ODoiZW5kcG9pbnQiO3M6NToidmFsdWUiO3M6Mzg6Imh0dHBzOi8vZGlzY292ZXJ5ZW5naW5lLmdvb2dsZWFwaXMuY29tIjt9czoxNToiU2VydmljZSBBY2NvdW50IjthOjI6e3M6Mzoia2V5IjtzOjE1OiJzZXJ2aWNlX2FjY291bnQiO3M6NToidmFsdWUiO3M6MTc6InNlcnZpY2VfYWNjb3VudF8xIjt9czoxODoiQWxsb3cgQ29udmVyc2F0aW9uIjthOjI6e3M6Mzoia2V5IjtzOjE4OiJhbGxvd19jb252ZXJzYXRpb24iO3M6NToidmFsdWUiO2k6MTt9fXM6MTE6Ik1vZGVsIFN0YXRlIjthOjE6e3M6Mjc6IkN1cnJlbnQgQ29udmVyc2F0aW9uIExlbmd0aCI7YToyOntzOjM6ImtleSI7czoxOToiY29udmVyc2F0aW9uX2xlbmd0aCI7czo1OiJ2YWx1ZSI7aToxO319czoxNDoiTW9kZWwgUmVzcG9uc2UiO2E6ODp7czo4OiJFbmRwb2ludCI7YToyOntzOjM6ImtleSI7czoyMToiY29udmVyc2F0aW9uX2VuZHBvaW50IjtzOjU6InZhbHVlIjtzOjE4MDoiaHR0cHM6Ly9kaXNjb3ZlcnllbmdpbmUuZ29vZ2xlYXBpcy5jb20vdjFhbHBoYS9wcm9qZWN0cy82MTIwNDI2MTI1ODgvbG9jYXRpb25zL2dsb2JhbC9jb2xsZWN0aW9ucy9kZWZhdWx0X2NvbGxlY3Rpb24vZGF0YVN0b3Jlcy9kcnVwYWx3ZWJzaXRlXzE3MDI5MTkxMTk3NjgvY29udmVyc2F0aW9ucy8tOmNvbnZlcnNlIjt9czoxMjoiQ29udmVyc2F0aW9uIjthOjI6e3M6Mzoia2V5IjtzOjE3OiJjb252ZXJzYXRpb25fbmFtZSI7czo1OiJ2YWx1ZSI7czoxNDI6InByb2plY3RzLzYxMjA0MjYxMjU4OC9sb2NhdGlvbnMvZ2xvYmFsL2NvbGxlY3Rpb25zL2RlZmF1bHRfY29sbGVjdGlvbi9kYXRhU3RvcmVzL2RydXBhbHdlYnNpdGVfMTcwMjkxOTExOTc2OC9jb252ZXJzYXRpb25zLzM2NDk1NDA3NDQ0NTIwNzE2MzEiO31zOjU6IlN0YXRlIjthOjI6e3M6Mzoia2V5IjtzOjE4OiJjb252ZXJzYXRpb25fc3RhdGUiO3M6NToidmFsdWUiO3M6MTE6IklOX1BST0dSRVNTIjt9czo4OiJQc2V1ZG9JZCI7YToyOntzOjM6ImtleSI7czoxNjoiY29udmVyc2F0aW9uX3JlZiI7czo1OiJ2YWx1ZSI7czoxOToiMzY0OTU0MDc0NDQ1MjA3MTYzMSI7fXM6MTg6IkRydXBhbCBJbnRlcm5hbCBJZCI7YToyOntzOjM6ImtleSI7czoxNToiY29udmVyc2F0aW9uX2lkIjtzOjU6InZhbHVlIjtzOjA6IiI7fXM6MTQ6IlF1ZXJ5IER1cmF0aW9uIjthOjI6e3M6Mzoia2V5IjtzOjI3OiJjb252ZXJzYXRpb25fcXVlcnlfZHVyYXRpb24iO3M6NToidmFsdWUiO2Q6My42Njc0MTM5NDk5NjY0MzA3O31zOjIzOiJTZWFyY2ggUmVzdWx0cyBSZXR1cm5lZCI7YToyOntzOjM6ImtleSI7czoxNDoicmVzdWx0c19sZW5ndGgiO3M6NToidmFsdWUiO2k6MTA7fXM6MTg6IkNpdGF0aW9ucyBSZXR1cm5lZCI7YToyOntzOjM6ImtleSI7czoxNjoiY2l0YXRpb25zX2xlbmd0aCI7czo1OiJ2YWx1ZSI7aTo0O319fXM6MTQ6InNlYXJjaF9yZXN1bHRzIjthOjg6e2k6MDthOjc6e3M6NzoiY29udGVudCI7czo3NDE6IlByaXZhdGUgbG9jYXRpb25zOiBZb3UgbmVlZCBwZXJtaXNzaW9uIGZyb20gdGhlIHByb3BlcnR5IG93bmVyLiBFYWNoIHR5cGUgb2YgbG9jYXRpb24gaGFzIGl0cyBvd24gcnVsZXMgYW5kIGxpY2Vuc2luZy4gUGxlYXNlIGdpdmUgdXMgdHdvIHdlZWtzIHRvIGFwcHJvdmUgeW91ciBwZXJtaXQuIFlvdSBjYW4gcGljayB1cCB5b3VyIHBlcm1pdCBhdCBQdWJsaWMgV29ya3M6IDEgQ2l0eSBIYWxsIFNxdWFyZSwgUm9vbSA3MTQgQm9zdG9uIENpdHkgSGFsbCwgQm9zdG9uLCBNQSAwMjIwMSBPZmZpY2UgaG91cnM6IE1vbmRheSB0aHJvdWdoIEZyaWRheSwgOSBhbSAtIDUgcG0gV2hlbiB5b3VyIGZvb2QgdHJ1Y2sgcGVybWl0IGlzIGFwcHJvdmVkLCB3ZSYjMzk7bGwgbGV0IHlvdSBrbm93IHdoZW4gd2UgaG9sZCB0aGUgbmV4dCBwdWJsaWMgc2l0ZSBsb3R0ZXJ5LiBzaG93IGhpZGUgQnkgZW1haWwgU3RlcCAxIEJlZm9yZSB5b3UgZ2V0IHN0YXJ0ZWQgYnkgZW1haWwgQmVmb3JlIHlvdSBjYW4gYXBwbHkgZm9yIGEgZm9vZCB0cnVjayBwZXJtaXQgeW91IG5lZWQ6IHBlcm1pdHMgZnJvbSBJbnNwZWN0aW9uYWwgU2VydmljZXMgYW5kIEZpcmUgYSBIYXdrZXIgYW5kIFBlZGRsZXIgTGljZW5zZSBhIEJ1c2luZXNzIENlcnRpZmljYXRlIGEgQ2VydGlmaWNhdGUgb2YgTGlhYmlsaXR5IEluc3VyYW5jZSBhIGJ1c2luZXNzIHBsYW4sIGFuZCBhIHdyaXR0ZW4gYWdyZWVtZW50IGZyb20geW91ciBjb21taXNzYXJ5LiI7czoyOiJpZCI7czozMjoiMDk1YWU0MjYwNjc3YjZjZTQ1ZTM1NzM1MGQzMWU2YTkiO3M6NDoibGluayI7czo4NzoiaHR0cHM6Ly93d3cuYm9zdG9uLmdvdi9kZXBhcnRtZW50cy9zbWFsbC1idXNpbmVzcy1kZXZlbG9wbWVudC9ob3ctZ2V0LWZvb2QtdHJ1Y2stcGVybWl0IjtzOjEwOiJsaW5rX3RpdGxlIjtzOjE0OiJ3d3cuYm9zdG9uLmdvdiI7czozOiJyZWYiO3M6MTYyOiJwcm9qZWN0cy82MTIwNDI2MTI1ODgvbG9jYXRpb25zL2dsb2JhbC9jb2xsZWN0aW9ucy9kZWZhdWx0X2NvbGxlY3Rpb24vZGF0YVN0b3Jlcy9kcnVwYWx3ZWJzaXRlXzE3MDI5MTkxMTk3NjgvYnJhbmNoZXMvMC9kb2N1bWVudHMvMDk1YWU0MjYwNjc3YjZjZTQ1ZTM1NzM1MGQzMWU2YTkiO3M6Nzoic3VtbWFyeSI7czo2MToiVGhlcmUgYXJlIHRocmVlIHdheXMgdG8gYXBwbHkgZm9yIGEgPGI+Zm9vZCB0cnVjayBwZXJtaXQ8L2I+LiI7czo1OiJ0aXRsZSI7czo0MzoiSG93IHRvIGdldCBhIGZvb2QgdHJ1Y2sgcGVybWl0IHwgQm9zdG9uLmdvdiI7fWk6MTthOjc6e3M6NzoiY29udGVudCI7czoyNzQ6IlRvIGdldCB0aGUgcGVybWl0LCB5b3UmIzM5O2xsIG5lZWQgYSBmaXJlIHN1cHByZXNzaW9uIHN5c3RlbSBhbmQgYSBmaXJlIGV4dGluZ3Vpc2hlci4gWW91JiMzOTtsbCBoYXZlIHRvIHJlbmV3IHRoaXMgcGVybWl0IGV2ZXJ5IHllYXIuIElmIHlvdXIgdHJ1Y2sgcGFzc2VzIHRoZSBmaXJlIGluc3BlY3Rpb24sIHlvdSYjMzk7bGwgYmUgZ2l2ZW4gYSBwZXJtaXQgYW5kIHRoZSBmaXJlIGluc3BlY3RvciB3aWxsIHNpZ24geW91ciBmb29kIHRydWNrIHBlcm1pdCBhcHBsaWNhdGlvbi4iO3M6MjoiaWQiO3M6MzI6IjJhMTc3MjE2ZTA4NTFiMTBkMjdmOGMzOGJmZmI1YzUyIjtzOjQ6ImxpbmsiO3M6MTA4OiJodHRwczovL3d3dy5ib3N0b24uZ292L2RlcGFydG1lbnRzL3NtYWxsLWJ1c2luZXNzLWRldmVsb3BtZW50L2hvdy1nZXQtaGVhbHRoLWFuZC1maXJlLXBlcm1pdC15b3VyLWZvb2QtdHJ1Y2siO3M6MTA6ImxpbmtfdGl0bGUiO3M6MTQ6Ind3dy5ib3N0b24uZ292IjtzOjM6InJlZiI7czoxNjI6InByb2plY3RzLzYxMjA0MjYxMjU4OC9sb2NhdGlvbnMvZ2xvYmFsL2NvbGxlY3Rpb25zL2RlZmF1bHRfY29sbGVjdGlvbi9kYXRhU3RvcmVzL2RydXBhbHdlYnNpdGVfMTcwMjkxOTExOTc2OC9icmFuY2hlcy8wL2RvY3VtZW50cy8yYTE3NzIxNmUwODUxYjEwZDI3ZjhjMzhiZmZiNWM1MiI7czo3OiJzdW1tYXJ5IjtzOjE4OToiU2NoZWR1bGUgYW4gaW5zcGVjdGlvbiAmbWlkZG90OyBPbmNlIHlvdXIgPGI+dHJ1Y2s8L2I+IGlzIGNvbXBsZXRlLCB5b3UgbmVlZCB0byA8Yj5nZXQ8L2I+IGl0IGluc3BlY3RlZCBiZWZvcmUgeW91IGNhbiBydW4geW91ciBidXNpbmVzcy4gJm1pZGRvdDsgQ2FsbCB0aGUgRmlyZSBEZXBhcnRtZW50IGZpcnN0IHRvJm5ic3A7Li4uIjtzOjU6InRpdGxlIjtzOjY4OiJIb3cgdG8gZ2V0IGEgSGVhbHRoIGFuZCBGaXJlIHBlcm1pdCBmb3IgeW91ciBmb29kIHRydWNrIHwgQm9zdG9uLmdvdiI7fWk6MjthOjc6e3M6NzoiY29udGVudCI7czo1MDg6ItCe0LTQvdCw0LrQviDQstGLINC80L7QttC10YLQtSDRgdC+0L7QsdGJ0LDRgtGMINC+INC90LXQv9GA0LDQstC40LvRjNC90YvRhSDQuNC70Lgg0L3QtdC60LDRh9C10YHRgtCy0LXQvdC90YvRhSDQv9C10YDQtdCy0L7QtNCw0YUg0Lgg0LLQvdC+0YHQuNGC0Ywg0LHQvtC70LXQtSDQutCw0YfQtdGB0YLQstC10L3QvdGL0LUg0L/QtdGA0LXQstC+0LTRiyDRgSDQv9C+0LzQvtGJ0YzRjiBHb29nbGUgVHJhbnNsYXRlLiDQodC90LDRh9Cw0LvQsCDQvdCw0LLQtdC00LjRgtC1INC60YPRgNGB0L7RgCDQvNGL0YjQuCDQuCDRidC10LvQutC90LjRgtC1INC70Y7QsdC+0Lkg0YLQtdC60YHRgiwg0YHQvtC00LXRgNC20LDRidC40Lkg0L7RiNC40LHQutGDLiDQlNC+0LvQttC90L4g0L/QvtGP0LLQuNGC0YzRgdGPINCy0YHQv9C70YvQstCw0Y7RidC10LUg0L7QutC90L4uINCU0LDQu9C10LUg0L3QsNC20LzQuNGC0LUg4oCc0JLQvdC10YHRgtC4INC70YPRh9GI0LjQuSDQv9C10YDQtdCy0L7QtOKAnC4iO3M6MjoiaWQiO3M6MzI6ImQ3ZGFmNjg0NDA0MjNlYmQ1ODNlYTcyMzVhNTMyODFiIjtzOjQ6ImxpbmsiO3M6NzM6Imh0dHBzOi8vd3d3LmJvc3Rvbi5nb3YvZGVwYXJ0bWVudHMvc21hbGwtYnVzaW5lc3MtZGV2ZWxvcG1lbnQvZm9vZC10cnVja3MiO3M6MTA6ImxpbmtfdGl0bGUiO3M6MTQ6Ind3dy5ib3N0b24uZ292IjtzOjM6InJlZiI7czoxNjI6InByb2plY3RzLzYxMjA0MjYxMjU4OC9sb2NhdGlvbnMvZ2xvYmFsL2NvbGxlY3Rpb25zL2RlZmF1bHRfY29sbGVjdGlvbi9kYXRhU3RvcmVzL2RydXBhbHdlYnNpdGVfMTcwMjkxOTExOTc2OC9icmFuY2hlcy8wL2RvY3VtZW50cy9kN2RhZjY4NDQwNDIzZWJkNTgzZWE3MjM1YTUzMjgxYiI7czo3OiJzdW1tYXJ5IjtzOjE5NzoiLi4uIG9mIGZvb2QgdHJ1Y2tzIGluIHRoZSBDaXR5IG9mIEJvc3RvbjogRm9vZCB0cnVja3MgbWFwLiBXaGVyZSB0byBzdGFydC4gPGI+SG93IHRvIGdldCBhIGZvb2QgdHJ1Y2sgcGVybWl0PC9iPiAmbWlkZG90OyBGb29kIHRydWNrIGxvdHRlcnkgJm1pZGRvdDsgRm9vZCB0cnVjayBncmFkaW5nICZtaWRkb3Q7IEZvb2QgdHJ1Y2smbmJzcDsuLi4iO3M6NToidGl0bGUiO3M6MjQ6IkZvb2QgVHJ1Y2tzIHwgQm9zdG9uLmdvdiI7fWk6MzthOjc6e3M6NzoiY29udGVudCI7czoyOTQ6IldlJiMzOTtsbCBuZWVkOiB5b3VyIGZvb2QgdHJ1Y2sgcGVybWl0IGFwcGxpY2F0aW9uIHRoZSBsZWFzZSBvciBsZXR0ZXIgb2YgYWdyZWVtZW50IGZyb20gdGhlIHByb3BlcnR5IG93bmVyIGEgcGhvdG8gb2YgdGhlIHNpdGUgYW5kIGEgZHJhd2luZyB0aGF0IHNob3dzIHdoZXJlIHlvdXIgdHJ1Y2sgd2lsbCBiZSBsb2NhdGVkIGFuZCBob3cgeW91IHBsYW4gdG8gc2VydmUgZm9vZCwgYW5kIGEgY29weSBvZiB5b3VyIFVzZSBvZiBQcmVtaXNlcyBwZXJtaXQgYXBwcm92ZWQgYnkgSW5zcGVjdGlvbmFsIFNlcnZpY2VzLiI7czoyOiJpZCI7czozMjoiOGMyMDc3OTZmZjVjNTBhNWM5NzMzZWM3YWMzMzQ4ZTMiO3M6NDoibGluayI7czo3ODoiaHR0cHM6Ly93d3cuYm9zdG9uLmdvdi9kZXBhcnRtZW50cy9zbWFsbC1idXNpbmVzcy1kZXZlbG9wbWVudC9mb29kLXRydWNrLXNpdGVzIjtzOjEwOiJsaW5rX3RpdGxlIjtzOjE0OiJ3d3cuYm9zdG9uLmdvdiI7czozOiJyZWYiO3M6MTYyOiJwcm9qZWN0cy82MTIwNDI2MTI1ODgvbG9jYXRpb25zL2dsb2JhbC9jb2xsZWN0aW9ucy9kZWZhdWx0X2NvbGxlY3Rpb24vZGF0YVN0b3Jlcy9kcnVwYWx3ZWJzaXRlXzE3MDI5MTkxMTk3NjgvYnJhbmNoZXMvMC9kb2N1bWVudHMvOGMyMDc3OTZmZjVjNTBhNWM5NzMzZWM3YWMzMzQ4ZTMiO3M6Nzoic3VtbWFyeSI7czoxOTI6IldlIGJhc2UgbW9udGhseSA8Yj5wZXJtaXQ8L2I+IGZlZXMgb24gaG93IG1hbnkgc2hpZnRzIHlvdSB3b3JrIGF0IGVhY2ggc2l0ZS4gWW91JiMzOTtsbCA8Yj5oYXZlPC9iPiB0byBwYXkgdGhlIGZlZSBmb3IgdGhlIG51bWJlciBvZiBzaGlmdHMgaW4gZWFjaCB6b25lIHRoYXQgeW91IDxiPmhhdmU8L2I+LiBZb3UgbXVzdCZuYnNwOy4uLiI7czo1OiJ0aXRsZSI7czoyOToiRm9vZCB0cnVjayBzaXRlcyB8IEJvc3Rvbi5nb3YiO31pOjQ7YTo3OntzOjc6ImNvbnRlbnQiO3M6NTA4OiLQntC00L3QsNC60L4g0LLRiyDQvNC+0LbQtdGC0LUg0YHQvtC+0LHRidCw0YLRjCDQviDQvdC10L/RgNCw0LLQuNC70YzQvdGL0YUg0LjQu9C4INC90LXQutCw0YfQtdGB0YLQstC10L3QvdGL0YUg0L/QtdGA0LXQstC+0LTQsNGFINC4INCy0L3QvtGB0LjRgtGMINCx0L7Qu9C10LUg0LrQsNGH0LXRgdGC0LLQtdC90L3Ri9C1INC/0LXRgNC10LLQvtC00Ysg0YEg0L/QvtC80L7RidGM0Y4gR29vZ2xlIFRyYW5zbGF0ZS4g0KHQvdCw0YfQsNC70LAg0L3QsNCy0LXQtNC40YLQtSDQutGD0YDRgdC+0YAg0LzRi9GI0Lgg0Lgg0YnQtdC70LrQvdC40YLQtSDQu9GO0LHQvtC5INGC0LXQutGB0YIsINGB0L7QtNC10YDQttCw0YnQuNC5INC+0YjQuNCx0LrRgy4g0JTQvtC70LbQvdC+INC/0L7Rj9Cy0LjRgtGM0YHRjyDQstGB0L/Qu9GL0LLQsNGO0YnQtdC1INC+0LrQvdC+LiDQlNCw0LvQtdC1INC90LDQttC80LjRgtC1IOKAnNCS0L3QtdGB0YLQuCDQu9GD0YfRiNC40Lkg0L/QtdGA0LXQstC+0LTigJwuIjtzOjI6ImlkIjtzOjMyOiI3NmMxMzMwY2I1ZTc0ZGNlOGVkMTIyY2RiYjdmMWI2NSI7czo0OiJsaW5rIjtzOjg4OiJodHRwczovL3d3dy5ib3N0b24uZ292L2RlcGFydG1lbnRzL2Vjb25vbWljLWRldmVsb3BtZW50L2Zvb2QtdHJ1Y2stcnVsZXMtYW5kLXJlZ3VsYXRpb25zIjtzOjEwOiJsaW5rX3RpdGxlIjtzOjE0OiJ3d3cuYm9zdG9uLmdvdiI7czozOiJyZWYiO3M6MTYyOiJwcm9qZWN0cy82MTIwNDI2MTI1ODgvbG9jYXRpb25zL2dsb2JhbC9jb2xsZWN0aW9ucy9kZWZhdWx0X2NvbGxlY3Rpb24vZGF0YVN0b3Jlcy9kcnVwYWx3ZWJzaXRlXzE3MDI5MTkxMTk3NjgvYnJhbmNoZXMvMC9kb2N1bWVudHMvNzZjMTMzMGNiNWU3NGRjZThlZDEyMmNkYmI3ZjFiNjUiO3M6Nzoic3VtbWFyeSI7czoxNzk6IlZlbmRpbmcgd2l0aG91dCBhbiBBbm51YWwgPGI+Rm9vZCBUcnVjayBQZXJtaXQ8L2I+IGlzIHByb2hpYml0ZWQgYnkgdGhlIENpdHkgb2YgQm9zdG9uIGZvciBhbGwgbW9iaWxlIGJ1c2luZXNzZXMuIC4uLiA8Yj5Gb29kIHRydWNrcyBoYXZlPC9iPiBhbiBvcHBvcnR1bml0eSB0byBkcm9wIHNpdGVzJm5ic3A7Li4uIjtzOjU6InRpdGxlIjtzOjMxOiJGb29kIHRydWNrIGxvdHRlcnkgfCBCb3N0b24uZ292Ijt9aTo1O2E6Nzp7czo3OiJjb250ZW50IjtzOjM2NzoiWW91JiMzOTtsbCBuZWVkIHRvIGdpdmUgdXMgc2V2ZXJhbCBkb2N1bWVudHMsIGluY2x1ZGluZzogeW91ciBjb21wbGV0ZWQgZm9vZCBzZXJ2aWNlIHBlcm1pdCBhcHBsaWNhdGlvbiBwYXltZW50IGZvciB5b3VyIHBlcm1pdCBmZWVzIGZvdXIgc2V0cyBvZiBzaXRlIHBsYW5zIGEgY29weSBvZiB5b3VyIGVxdWlwbWVudCBzcGVjaWZpY2F0aW9ucyBmcm9tIHRoZSBtYW51ZmFjdHVyZXIgeW91ciBGb29kIFBsYW4gUmV2aWV3IFdvcmtzaGVldCBhIGNvcHkgb2YgeW91ciBtZW51IHdpdGggY29uc3VtZXIgYWR2aXNvcmllcyAoaWYgdGhleSBhcHBseSB0byB5b3UpLCBhbmQgYSBidWlsZGluZyBwZXJtaXQgc2lnbmVkIGJ5IG91ciBpbnNwZWN0b3JzLiI7czoyOiJpZCI7czozMjoiYjY1NjU5NDIxMmE2N2YyMTAxYmI5MzYyZjQ2MzhlZWUiO3M6NDoibGluayI7czo4NDoiaHR0cHM6Ly93d3cuYm9zdG9uLmdvdi9kZXBhcnRtZW50cy9pbnNwZWN0aW9uYWwtc2VydmljZXMvaG93LWdldC1mb29kLXNlcnZpY2UtcGVybWl0IjtzOjEwOiJsaW5rX3RpdGxlIjtzOjE0OiJ3d3cuYm9zdG9uLmdvdiI7czozOiJyZWYiO3M6MTYyOiJwcm9qZWN0cy82MTIwNDI2MTI1ODgvbG9jYXRpb25zL2dsb2JhbC9jb2xsZWN0aW9ucy9kZWZhdWx0X2NvbGxlY3Rpb24vZGF0YVN0b3Jlcy9kcnVwYWx3ZWJzaXRlXzE3MDI5MTkxMTk3NjgvYnJhbmNoZXMvMC9kb2N1bWVudHMvYjY1NjU5NDIxMmE2N2YyMTAxYmI5MzYyZjQ2MzhlZWUiO3M6Nzoic3VtbWFyeSI7czoxMjU6IllvdSBjYW4gYXBwbHkgZm9yIGEgPGI+cGVybWl0PC9iPiB3aGlsZSB5b3VyIGJ1c2luZXNzIGlzIGJlaW5nIGJ1aWx0LCBvciA8Yj5nZXQ8L2I+IGEgPGI+cGVybWl0PC9iPiBmb3IgYW4gZXhpc3RpbmcgYnVzaW5lc3MuIjtzOjU6InRpdGxlIjtzOjQ1OiJIb3cgdG8gZ2V0IGEgZm9vZCBzZXJ2aWNlIHBlcm1pdCB8IEJvc3Rvbi5nb3YiO31pOjY7YTo3OntzOjc6ImNvbnRlbnQiO3M6NTA4OiLQntC00L3QsNC60L4g0LLRiyDQvNC+0LbQtdGC0LUg0YHQvtC+0LHRidCw0YLRjCDQviDQvdC10L/RgNCw0LLQuNC70YzQvdGL0YUg0LjQu9C4INC90LXQutCw0YfQtdGB0YLQstC10L3QvdGL0YUg0L/QtdGA0LXQstC+0LTQsNGFINC4INCy0L3QvtGB0LjRgtGMINCx0L7Qu9C10LUg0LrQsNGH0LXRgdGC0LLQtdC90L3Ri9C1INC/0LXRgNC10LLQvtC00Ysg0YEg0L/QvtC80L7RidGM0Y4gR29vZ2xlIFRyYW5zbGF0ZS4g0KHQvdCw0YfQsNC70LAg0L3QsNCy0LXQtNC40YLQtSDQutGD0YDRgdC+0YAg0LzRi9GI0Lgg0Lgg0YnQtdC70LrQvdC40YLQtSDQu9GO0LHQvtC5INGC0LXQutGB0YIsINGB0L7QtNC10YDQttCw0YnQuNC5INC+0YjQuNCx0LrRgy4g0JTQvtC70LbQvdC+INC/0L7Rj9Cy0LjRgtGM0YHRjyDQstGB0L/Qu9GL0LLQsNGO0YnQtdC1INC+0LrQvdC+LiDQlNCw0LvQtdC1INC90LDQttC80LjRgtC1IOKAnNCS0L3QtdGB0YLQuCDQu9GD0YfRiNC40Lkg0L/QtdGA0LXQstC+0LTigJwuIjtzOjI6ImlkIjtzOjMyOiJmY2Q5YWNhNTE1M2IwMDUzMmJiNzMyZDdlNjZmMzZjMiI7czo0OiJsaW5rIjtzOjk2OiJodHRwczovL3d3dy5ib3N0b24uZ292L2RlcGFydG1lbnRzL3NtYWxsLWJ1c2luZXNzLWRldmVsb3BtZW50L2hvdy1nZXQtaGF3a2VyLWFuZC1wZWRkbGVyLWxpY2Vuc2UiO3M6MTA6ImxpbmtfdGl0bGUiO3M6MTQ6Ind3dy5ib3N0b24uZ292IjtzOjM6InJlZiI7czoxNjI6InByb2plY3RzLzYxMjA0MjYxMjU4OC9sb2NhdGlvbnMvZ2xvYmFsL2NvbGxlY3Rpb25zL2RlZmF1bHRfY29sbGVjdGlvbi9kYXRhU3RvcmVzL2RydXBhbHdlYnNpdGVfMTcwMjkxOTExOTc2OC9icmFuY2hlcy8wL2RvY3VtZW50cy9mY2Q5YWNhNTE1M2IwMDUzMmJiNzMyZDdlNjZmMzZjMiI7czo3OiJzdW1tYXJ5IjtzOjE5MzoiQXBwbHkgd2l0aCB0aGUgc3RhdGUgJm1pZGRvdDsgTmVlZCB0byBLbm93OiBFYWNoIHdvcmtlciB3aG8gaGFuZGxlcyBtb25leSBvbiBhIDxiPmZvb2QgdHJ1Y2s8L2I+IG5lZWRzIHRvIDxiPmdldDwvYj4gYSBoYXdrZXIgYW5kIHBlZGRsZXIgPGI+bGljZW5zZTwvYj4gdGhyb3VnaCB0aGUgc3RhdGUuIFRoZXkgbmVlZCB0byZuYnNwOy4uLiI7czo1OiJ0aXRsZSI7czo1MjoiSG93IHRvIGdldCBhIGhhd2tlciBhbmQgcGVkZGxlciBsaWNlbnNlIHwgQm9zdG9uLmdvdiI7fWk6NzthOjc6e3M6NzoiY29udGVudCI7czoyMzk6Ikluc3BlY3Rpb25hbCBTZXJ2aWNlcyBEZXBhcnRtZW50IFRlbXBvcmFyeSBmb29kIHNlcnZpY2UgcGVybWl0IERvd25sb2FkIHRoZSBhcHBsaWNhdGlvbiBmb3IgYSB0ZW1wb3JhcnkgZm9vZCBzZXJ2aWNlIHBlcm1pdC4gSW5zcGVjdGlvbmFsIFNlcnZpY2VzIERlcGFydG1lbnQgUmVndWxhdGlvbnMgZm9yIGZvb2QgdHJ1Y2tzIFJldmlldyB0aGUgcmVndWxhdGlvbnMgZm9yIGZvb2QgdHJ1Y2tzIGF0IHlvdXIgZXZlbnQuIjtzOjI6ImlkIjtzOjMyOiI5ODcxMzZlMThkOGU5MjZjNTVlNmEwYTJmYTVhZWRkMyI7czo0OiJsaW5rIjtzOjk1OiJodHRwczovL3d3dy5ib3N0b24uZ292L2RlcGFydG1lbnRzL2VudGVydGFpbm1lbnQtbGljZW5zaW5nL2NvbW1vbi1wZXJtaXRzLXNwZWNpYWwtZXZlbnRzLWJvc3RvbiI7czoxMDoibGlua190aXRsZSI7czoxNDoid3d3LmJvc3Rvbi5nb3YiO3M6MzoicmVmIjtzOjE2MjoicHJvamVjdHMvNjEyMDQyNjEyNTg4L2xvY2F0aW9ucy9nbG9iYWwvY29sbGVjdGlvbnMvZGVmYXVsdF9jb2xsZWN0aW9uL2RhdGFTdG9yZXMvZHJ1cGFsd2Vic2l0ZV8xNzAyOTE5MTE5NzY4L2JyYW5jaGVzLzAvZG9jdW1lbnRzLzk4NzEzNmUxOGQ4ZTkyNmM1NWU2YTBhMmZhNWFlZGQzIjtzOjc6InN1bW1hcnkiO3M6MTk3OiJCdWlsZGluZyBhbmQgc2FmZXR5IDxiPnBlcm1pdHM8L2I+LiBXaWxsIHlvdXIgZXZlbnQgPGI+aGF2ZTwvYj4gYSB0ZW50LCBzdGFnZSwgdGVtcG9yYXJ5IHN0cnVjdHVyZSwgc3BlY2lhbCBlZmZlY3RzLCBvciBhIGdlbmVyYXRvcj8gOyA8Yj5Gb29kPC9iPiBzYWZldHkgYW5kIGhlYWx0aCA8Yj5wZXJtaXRzPC9iPi4gQXJlIHlvdSZuYnNwOy4uLiI7czo1OiJ0aXRsZSI7czo0MzoiQ29tbW9uIHBlcm1pdHMgZm9yIHNwZWNpYWwgZXZlbnRzIGluIEJvc3RvbiI7fX1zOjQ6ImJvYnkiO3M6OTA5OiIqKkNBQ0hFRCoqIFRvIGdldCBhIGZvb2QgdHJ1Y2sgcGVybWl0IGluIEJvc3RvbiwgeW91J2xsIG5lZWQgc2V2ZXJhbCBkb2N1bWVudHMsIGluY2x1ZGluZyBwZXJtaXRzIGZyb20gSW5zcGVjdGlvbmFsIFNlcnZpY2VzIGFuZCBGaXJlLCBhIEhhd2tlciBhbmQgUGVkZGxlciBMaWNlbnNlLCBhIEJ1c2luZXNzIENlcnRpZmljYXRlLCBhIENlcnRpZmljYXRlIG9mIExpYWJpbGl0eSBJbnN1cmFuY2UsIGEgYnVzaW5lc3MgcGxhbiwgYW5kIGEgd3JpdHRlbiBhZ3JlZW1lbnQgZnJvbSB5b3VyIGNvbW1pc3NhcnkuIFsxXSBZb3UnbGwgYWxzbyBuZWVkIGEgZmlyZSBzdXBwcmVzc2lvbiBzeXN0ZW0gYW5kIGEgZmlyZSBleHRpbmd1aXNoZXIgZm9yIHlvdXIgdHJ1Y2suIFsyXSBPbmNlIHlvdXIgdHJ1Y2sgcGFzc2VzIHRoZSBmaXJlIGluc3BlY3Rpb24sIHRoZSBmaXJlIGluc3BlY3RvciB3aWxsIHNpZ24geW91ciBmb29kIHRydWNrIHBlcm1pdCBhcHBsaWNhdGlvbi4gWzJdICBZb3UnbGwgbmVlZCB0byBnZXQgcGVybWlzc2lvbiBmcm9tIHRoZSBwcm9wZXJ0eSBvd25lciBpZiB5b3UgcGxhbiB0byBvcGVyYXRlIGluIGEgcHJpdmF0ZSBsb2NhdGlvbi4gWzFdICBGaW5hbGx5LCB5b3UnbGwgbmVlZCB0byBzdWJtaXQgeW91ciBmb29kIHRydWNrIHBlcm1pdCBhcHBsaWNhdGlvbiwgYSBsZWFzZSBvciBsZXR0ZXIgb2YgYWdyZWVtZW50IGZyb20gdGhlIHByb3BlcnR5IG93bmVyLCBhIHBob3RvIG9mIHRoZSBzaXRlLCBhIGRyYXdpbmcgc2hvd2luZyB3aGVyZSB5b3VyIHRydWNrIHdpbGwgYmUgbG9jYXRlZCBhbmQgaG93IHlvdSBwbGFuIHRvIHNlcnZlIGZvb2QsIGFuZCBhIGNvcHkgb2YgeW91ciBVc2Ugb2YgUHJlbWlzZXMgcGVybWl0IGFwcHJvdmVkIGJ5IEluc3BlY3Rpb25hbCBTZXJ2aWNlcy4gWzVdIAoiO3M6OToiY2l0YXRpb25zIjthOjU6e2k6MTthOjQ6e3M6NToidGl0bGUiO3M6NDM6IkhvdyB0byBnZXQgYSBmb29kIHRydWNrIHBlcm1pdCB8IEJvc3Rvbi5nb3YiO3M6ODoiZG9jdW1lbnQiO3M6MTYyOiJwcm9qZWN0cy82MTIwNDI2MTI1ODgvbG9jYXRpb25zL2dsb2JhbC9jb2xsZWN0aW9ucy9kZWZhdWx0X2NvbGxlY3Rpb24vZGF0YVN0b3Jlcy9kcnVwYWx3ZWJzaXRlXzE3MDI5MTkxMTk3NjgvYnJhbmNoZXMvMC9kb2N1bWVudHMvMDk1YWU0MjYwNjc3YjZjZTQ1ZTM1NzM1MGQzMWU2YTkiO3M6MzoidXJpIjtzOjg3OiJodHRwczovL3d3dy5ib3N0b24uZ292L2RlcGFydG1lbnRzL3NtYWxsLWJ1c2luZXNzLWRldmVsb3BtZW50L2hvdy1nZXQtZm9vZC10cnVjay1wZXJtaXQiO3M6OToibG9jYXRpb25zIjthOjI6e2k6MDthOjI6e3M6MTA6InN0YXJ0SW5kZXgiO2k6MDtzOjg6ImVuZEluZGV4IjtzOjM6IjM2MSI7fWk6MTthOjI6e3M6MTA6InN0YXJ0SW5kZXgiO3M6MzoiMzYyIjtzOjg6ImVuZEluZGV4IjtzOjM6IjQ3MCI7fX19aToyO2E6NDp7czo1OiJ0aXRsZSI7czo2ODoiSG93IHRvIGdldCBhIEhlYWx0aCBhbmQgRmlyZSBwZXJtaXQgZm9yIHlvdXIgZm9vZCB0cnVjayB8IEJvc3Rvbi5nb3YiO3M6ODoiZG9jdW1lbnQiO3M6MTYyOiJwcm9qZWN0cy82MTIwNDI2MTI1ODgvbG9jYXRpb25zL2dsb2JhbC9jb2xsZWN0aW9ucy9kZWZhdWx0X2NvbGxlY3Rpb24vZGF0YVN0b3Jlcy9kcnVwYWx3ZWJzaXRlXzE3MDI5MTkxMTk3NjgvYnJhbmNoZXMvMC9kb2N1bWVudHMvMmExNzcyMTZlMDg1MWIxMGQyN2Y4YzM4YmZmYjVjNTIiO3M6MzoidXJpIjtzOjEwODoiaHR0cHM6Ly93d3cuYm9zdG9uLmdvdi9kZXBhcnRtZW50cy9zbWFsbC1idXNpbmVzcy1kZXZlbG9wbWVudC9ob3ctZ2V0LWhlYWx0aC1hbmQtZmlyZS1wZXJtaXQteW91ci1mb29kLXRydWNrIjtzOjk6ImxvY2F0aW9ucyI7YTowOnt9fWk6MzthOjQ6e3M6NToidGl0bGUiO3M6MjQ6IkZvb2QgVHJ1Y2tzIHwgQm9zdG9uLmdvdiI7czo4OiJkb2N1bWVudCI7czoxNjI6InByb2plY3RzLzYxMjA0MjYxMjU4OC9sb2NhdGlvbnMvZ2xvYmFsL2NvbGxlY3Rpb25zL2RlZmF1bHRfY29sbGVjdGlvbi9kYXRhU3RvcmVzL2RydXBhbHdlYnNpdGVfMTcwMjkxOTExOTc2OC9icmFuY2hlcy8wL2RvY3VtZW50cy9kN2RhZjY4NDQwNDIzZWJkNTgzZWE3MjM1YTUzMjgxYiI7czozOiJ1cmkiO3M6NzM6Imh0dHBzOi8vd3d3LmJvc3Rvbi5nb3YvZGVwYXJ0bWVudHMvc21hbGwtYnVzaW5lc3MtZGV2ZWxvcG1lbnQvZm9vZC10cnVja3MiO3M6OToibG9jYXRpb25zIjthOjA6e319aTo0O2E6NDp7czo1OiJ0aXRsZSI7czoyNDoiRm9vZCBUcnVja3MgfCBCb3N0b24uZ292IjtzOjg6ImRvY3VtZW50IjtzOjE2MjoicHJvamVjdHMvNjEyMDQyNjEyNTg4L2xvY2F0aW9ucy9nbG9iYWwvY29sbGVjdGlvbnMvZGVmYXVsdF9jb2xsZWN0aW9uL2RhdGFTdG9yZXMvZHJ1cGFsd2Vic2l0ZV8xNzAyOTE5MTE5NzY4L2JyYW5jaGVzLzAvZG9jdW1lbnRzL2IxZWE5MmFlOWJmY2Q5MzA5MzA0MDYxMDgxZjUxMmNkIjtzOjM6InVyaSI7czo1NToiaHR0cHM6Ly93d3cuYm9zdG9uLmdvdi9lY29ub21pYy1kZXZlbG9wbWVudC9mb29kLXRydWNrcyI7czo5OiJsb2NhdGlvbnMiO2E6MTp7aTowO2E6Mjp7czoxMDoic3RhcnRJbmRleCI7czozOiI1NzMiO3M6ODoiZW5kSW5kZXgiO3M6MzoiODc2Ijt9fX1pOjU7YTo0OntzOjU6InRpdGxlIjtzOjI5OiJGb29kIHRydWNrIHNpdGVzIHwgQm9zdG9uLmdvdiI7czo4OiJkb2N1bWVudCI7czoxNjI6InByb2plY3RzLzYxMjA0MjYxMjU4OC9sb2NhdGlvbnMvZ2xvYmFsL2NvbGxlY3Rpb25zL2RlZmF1bHRfY29sbGVjdGlvbi9kYXRhU3RvcmVzL2RydXBhbHdlYnNpdGVfMTcwMjkxOTExOTc2OC9icmFuY2hlcy8wL2RvY3VtZW50cy84YzIwNzc5NmZmNWM1MGE1Yzk3MzNlYzdhYzMzNDhlMyI7czozOiJ1cmkiO3M6Nzg6Imh0dHBzOi8vd3d3LmJvc3Rvbi5nb3YvZGVwYXJ0bWVudHMvc21hbGwtYnVzaW5lc3MtZGV2ZWxvcG1lbnQvZm9vZC10cnVjay1zaXRlcyI7czo5OiJsb2NhdGlvbnMiO2E6MDp7fX19czoxNToiY29udmVyc2F0aW9uX2lkIjtzOjE5OiIzNjQ5NTQwNzQ0NDUyMDcxNjMxIjt9");
    return unserialize($a);
  }

  /**
   * @inheritDoc
   */
  public function availablePrompts(): array {
    return $this->service->availablePrompts();
  }

  /**
   * @param array &$elements
   * @param array $map
   * @param array $exclude_elem
   * @param string $prefix *
   *
* @inheritDoc
   */
  protected function flattenMetadata(array &$metadata, array $map = [], array $exclude_elem = []):array {

    $map = [];
    $exclude_elem = [];
    return parent::flattenMetadata($metadata, $map, $exclude_elem);
  }

}
