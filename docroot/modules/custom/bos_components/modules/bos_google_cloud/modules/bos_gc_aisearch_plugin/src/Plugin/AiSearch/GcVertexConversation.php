<?php

namespace Drupal\bos_gc_aisearch_plugin\Plugin\AiSearch;

use Drupal\bos_google_cloud\Services\GcConversation;
use Drupal\bos_search\AiSearchBase;
use Drupal\bos_search\AiSearchInterface;
use Drupal\bos_search\AiSearchRequest;
use Drupal\bos_search\AiSearchResponse;
use Drupal\bos_search\AiSearchResult;
use Drupal\bos_search\Annotation\AiSearchAnnotation;

/**
 * Provides an 'AiSearch' plugin for bos_google_cloud.
 *
 * @AiSearchAnnotation (
 *   id = "Vertex Conversation",
 *   service = "bos_google_cloud.GcConversation",
 *   description = "Plugin for Google Cloud Vertex Conversation Service"
 * )
 */
class GcVertexConversation extends AiSearchBase implements AiSearchInterface {

  /** @var \Drupal\bos_google_cloud\Services\GcConversation Holds the injected Vertex service. */
  protected GcConversation $vertex;

  /** @injectDoc */
  public function __construct(array $configuration, $plugin_id, $plugin_definition) {
    parent::__construct($configuration, $plugin_id, $plugin_definition);
    // Inject the GcSearch service.
    $this->vertex = \Drupal::getContainer()->get("bos_google_cloud.GcConversation");
  }

  /**
   * @param \Drupal\bos_search\AiSearchRequest $request
   * @param bool $fake *
   *
* @inheritDoc
   */
  public function search(AiSearchRequest $request, bool $fake = FALSE): AiSearchResponse {
    try {
      // Ask the search question to Vertex.
      if ($fake) {
        $result = $this->fakeResponse();
        if (empty($request->get("conversation_id"))) {
          $result["conversation_id"] = rand(10000000,99999999);
        }
        else {
          $result["conversation_id"] = $request->get("conversation_id");
        }
      }
      else {
        $this->vertex->execute([
          "text" => $request->get("search_text") ?? "",
          "conversation_id" => $request->get("conversation_id"),
          "prompt" => $request->get("prompt"),
          "num_results" => $request->get("result_count") ?? 0,
          "include_citations" => ($request->get("include_citations") == 1) ?? FALSE
        ]);
        $result = $this->vertex->getResults();
      }
    }
    catch (\Exception $e) {
      $result = FALSE;
    }

    // Load the GcSearchConversationResponse into the AiSearchResponse fmt.
    if ($result) {
      $response = new AiSearchResponse($request, $result['ai_answer'], $result['conversation_id'] ?? "");
      $response->set("body", $result['body'])
        ->set("metadata", $result['metadata'])
        ->set("references", $result['references']);
      if (($request->get("include_citations") ?? 0) === 1) {
        $response->set("citations", $result['citations'] ?? []);
      }
      foreach($result['search_results'] as $search_result) {
        // Load each search result into the AiSearchResult format.
        $res = new AiSearchResult($search_result["title"], $search_result["link"], $search_result["summary"]);
        $res->set("id", $search_result["id"])
          ->set("link_title", $search_result["link_title"])
          ->set("ref", $search_result["ref"]);
        $response->addResult($res);
      }
      $response->set("search", $request);
    }

    return $response;
  }

  /**
   * @inheritDoc
   */
  public function hasConversation(): bool {
    return $this->vertex->hasConversation();
  }

  private function fakeResponse() {
    $a = base64_decode("YTo3OntzOjk6ImFpX2Fuc3dlciI7czo0OTg6Ikl0J3MgZGlmZmljdWx0IHRvIHNheSBkZWZpbml0aXZlbHkgd2hpY2ggc2Nob29sIGlzICJ0aGUgYmVzdCIgaW4gQm9zdG9uLCBhcyBkaWZmZXJlbnQgc2Nob29scyBleGNlbCBpbiBkaWZmZXJlbnQgYXJlYXMuIEhvd2V2ZXIsIHRoZSBPJ0JyeWFudCBTY2hvb2wgaW4gdGhlIFdlc3QgUm94YnVyeSBFZHVjYXRpb24gQ29tcGxleCBpcyBjb25zaWRlcmVkIHRoZSBwcmVtaWVyIFNURU0gaGlnaCBzY2hvb2wgaW4gTWFzc2FjaHVzZXR0cy4gWzQsIDVdIEl0IG9mZmVycyBkdWFsIGVucm9sbG1lbnQgb3Bwb3J0dW5pdGllcyBmb3Igc3R1ZGVudHMgYW5kIGF0dHJhY3RzIGludGVyZXN0IGZyb20gcGFydG5lcnMgaW4gaGlnaGVyIGVkdWNhdGlvbiBhbmQgdGhlIHByaXZhdGUgYW5kIHB1YmxpYyBzZWN0b3JzLiBbNCwgNV0gIEZvciBtb3JlIGluZm9ybWF0aW9uIG9uIEJvc3RvbiBQdWJsaWMgU2Nob29scywgeW91IGNhbiB2aXNpdCB0aGUgQm9zdG9uLmdvdiB3ZWJzaXRlLiBbMV0gCiI7czo0OiJib2R5IjtzOjQ5ODoiSXQncyBkaWZmaWN1bHQgdG8gc2F5IGRlZmluaXRpdmVseSB3aGljaCBzY2hvb2wgaXMgInRoZSBiZXN0IiBpbiBCb3N0b24sIGFzIGRpZmZlcmVudCBzY2hvb2xzIGV4Y2VsIGluIGRpZmZlcmVudCBhcmVhcy4gSG93ZXZlciwgdGhlIE8nQnJ5YW50IFNjaG9vbCBpbiB0aGUgV2VzdCBSb3hidXJ5IEVkdWNhdGlvbiBDb21wbGV4IGlzIGNvbnNpZGVyZWQgdGhlIHByZW1pZXIgU1RFTSBoaWdoIHNjaG9vbCBpbiBNYXNzYWNodXNldHRzLiBbNCwgNV0gSXQgb2ZmZXJzIGR1YWwgZW5yb2xsbWVudCBvcHBvcnR1bml0aWVzIGZvciBzdHVkZW50cyBhbmQgYXR0cmFjdHMgaW50ZXJlc3QgZnJvbSBwYXJ0bmVycyBpbiBoaWdoZXIgZWR1Y2F0aW9uIGFuZCB0aGUgcHJpdmF0ZSBhbmQgcHVibGljIHNlY3RvcnMuIFs0LCA1XSAgRm9yIG1vcmUgaW5mb3JtYXRpb24gb24gQm9zdG9uIFB1YmxpYyBTY2hvb2xzLCB5b3UgY2FuIHZpc2l0IHRoZSBCb3N0b24uZ292IHdlYnNpdGUuIFsxXSAKIjtzOjk6ImNpdGF0aW9ucyI7YToxOntzOjk6ImNpdGF0aW9ucyI7YTozOntpOjA7YTozOntzOjEwOiJzdGFydEluZGV4IjtzOjM6IjEyMCI7czo4OiJlbmRJbmRleCI7czozOiIyNDciO3M6Nzoic291cmNlcyI7YToyOntpOjA7YToxOntzOjE0OiJyZWZlcmVuY2VJbmRleCI7czoxOiIzIjt9aToxO2E6MTp7czoxNDoicmVmZXJlbmNlSW5kZXgiO3M6MToiNCI7fX19aToxO2E6Mzp7czoxMDoic3RhcnRJbmRleCI7czozOiIyNDgiO3M6ODoiZW5kSW5kZXgiO3M6MzoiMzkyIjtzOjc6InNvdXJjZXMiO2E6Mjp7aTowO2E6MTp7czoxNDoicmVmZXJlbmNlSW5kZXgiO3M6MToiMyI7fWk6MTthOjE6e3M6MTQ6InJlZmVyZW5jZUluZGV4IjtzOjE6IjQiO319fWk6MjthOjM6e3M6MTA6InN0YXJ0SW5kZXgiO3M6MzoiMzk0IjtzOjg6ImVuZEluZGV4IjtzOjM6IjQ3OCI7czo3OiJzb3VyY2VzIjthOjE6e2k6MDthOjA6e319fX19czo4OiJtZXRhZGF0YSI7YToxOntzOjY6InNhZmV0eSI7YTowOnt9fXM6MTA6InJlZmVyZW5jZXMiO2E6NTp7aTowO2E6Mzp7czo1OiJ0aXRsZSI7czoyMDoiU2Nob29scyB8IEJvc3Rvbi5nb3YiO3M6ODoiZG9jdW1lbnQiO3M6MTYyOiJwcm9qZWN0cy82MTIwNDI2MTI1ODgvbG9jYXRpb25zL2dsb2JhbC9jb2xsZWN0aW9ucy9kZWZhdWx0X2NvbGxlY3Rpb24vZGF0YVN0b3Jlcy9kcnVwYWx3ZWJzaXRlXzE3MDI5MTkxMTk3NjgvYnJhbmNoZXMvMC9kb2N1bWVudHMvOWI4MWE0NzZlNmU1MzIyYzM4YWQ0NTYzMWI0NjQ1YTMiO3M6MzoidXJpIjtzOjQyOiJodHRwczovL3d3dy5ib3N0b24uZ292L2RlcGFydG1lbnRzL3NjaG9vbHMiO31pOjE7YTozOntzOjU6InRpdGxlIjtzOjQyOiJBIEdyZWVuIE5ldyBEZWFsIGZvciBCb3N0b24gUHVibGljIFNjaG9vbHMiO3M6ODoiZG9jdW1lbnQiO3M6MTYyOiJwcm9qZWN0cy82MTIwNDI2MTI1ODgvbG9jYXRpb25zL2dsb2JhbC9jb2xsZWN0aW9ucy9kZWZhdWx0X2NvbGxlY3Rpb24vZGF0YVN0b3Jlcy9kcnVwYWx3ZWJzaXRlXzE3MDI5MTkxMTk3NjgvYnJhbmNoZXMvMC9kb2N1bWVudHMvOTk5MmFiNTFhN2E1ZjA0MDM0YWY4NWE0NmQ4MTNmNWMiO3M6MzoidXJpIjtzOjY5OiJodHRwczovL3d3dy5ib3N0b24uZ292L2VkdWNhdGlvbi9ncmVlbi1uZXctZGVhbC1ib3N0b24tcHVibGljLXNjaG9vbHMiO31pOjI7YTozOntzOjU6InRpdGxlIjtzOjUyOiJGcmVzaCBmb29kIHByb2dyYW0gZXhwYW5kZWQgYXQgQm9zdG9uIFB1YmxpYyBTY2hvb2xzIjtzOjg6ImRvY3VtZW50IjtzOjE2MjoicHJvamVjdHMvNjEyMDQyNjEyNTg4L2xvY2F0aW9ucy9nbG9iYWwvY29sbGVjdGlvbnMvZGVmYXVsdF9jb2xsZWN0aW9uL2RhdGFTdG9yZXMvZHJ1cGFsd2Vic2l0ZV8xNzAyOTE5MTE5NzY4L2JyYW5jaGVzLzAvZG9jdW1lbnRzLzZiYzFjOTBkOTQyODY1NjQ0NGQzM2QyNzhiNGE1MTA5IjtzOjM6InVyaSI7czo3NzoiaHR0cHM6Ly93d3cuYm9zdG9uLmdvdi9uZXdzL2ZyZXNoLWZvb2QtcHJvZ3JhbS1leHBhbmRlZC1ib3N0b24tcHVibGljLXNjaG9vbHMiO31pOjM7YTozOntzOjU6InRpdGxlIjtzOjQzOiJXZXN0IFJveGJ1cnkgRWR1Y2F0aW9uIENvbXBsZXggfCBCb3N0b24uZ292IjtzOjg6ImRvY3VtZW50IjtzOjE2MjoicHJvamVjdHMvNjEyMDQyNjEyNTg4L2xvY2F0aW9ucy9nbG9iYWwvY29sbGVjdGlvbnMvZGVmYXVsdF9jb2xsZWN0aW9uL2RhdGFTdG9yZXMvZHJ1cGFsd2Vic2l0ZV8xNzAyOTE5MTE5NzY4L2JyYW5jaGVzLzAvZG9jdW1lbnRzLzE5MTM5ZDk1ZTIxZjc1OTIyNjZjNmYwN2E2MGNhZGVkIjtzOjM6InVyaSI7czo2MzoiaHR0cHM6Ly93d3cuYm9zdG9uLmdvdi9lZHVjYXRpb24vd2VzdC1yb3hidXJ5LWVkdWNhdGlvbi1jb21wbGV4Ijt9aTo0O2E6Mzp7czo1OiJ0aXRsZSI7czo0MzoiV2VzdCBSb3hidXJ5IEVkdWNhdGlvbiBDb21wbGV4IHwgQm9zdG9uLmdvdiI7czo4OiJkb2N1bWVudCI7czoxNjI6InByb2plY3RzLzYxMjA0MjYxMjU4OC9sb2NhdGlvbnMvZ2xvYmFsL2NvbGxlY3Rpb25zL2RlZmF1bHRfY29sbGVjdGlvbi9kYXRhU3RvcmVzL2RydXBhbHdlYnNpdGVfMTcwMjkxOTExOTc2OC9icmFuY2hlcy8wL2RvY3VtZW50cy9jY2Y2NjZmYTQ1ZGQ1Y2JjYWEwMjlhMjhkZTdiNmM4MSI7czozOiJ1cmkiO3M6Nzk6Imh0dHBzOi8vd3d3LmJvc3Rvbi5nb3YvZWR1Y2F0aW9uL25ldy1oaWdoLXNjaG9vbC13ZXN0LXJveGJ1cnktZWR1Y2F0aW9uLWNvbXBsZXgiO319czoxNDoic2VhcmNoX3Jlc3VsdHMiO2E6MTA6e2k6MDthOjc6e3M6NzoiY29udGVudCI7czo4NDk6Itin2YTZhdi52YTZiNmF2KfYqiDYp9mE2YfYp9mF2Kkg2KfZhNmF2KrYudmE2YLYqSDYqNin2LPYqtis2KfYqNipINio2YjYs9i32YYg2YTYrdin2YTYqSDYt9mI2KfYsdimINin2YTZgdmK2LHZiNiz2KfYqiDYp9mE2KrYp9is2YrYqSDZhdiq2KfYrdipINio2KfZhNmB2LnZhCDYqNmE2LrYp9iqINmF2KrYudiv2K/YqSDZiNmK2YXZg9mGINin2YTYudir2YjYsSDYudmE2YrZh9inINmH2YbYpzog2KfZhNij2LPYqNin2YbZitipOiBib3N0b24uZ292L2NvdmlkMTktZXMg2KfZhNmD2LHZitmI2YTZitipINin2YTZh9in2YrYqtmK2Kk6IGJvc3Rvbi5nb3YvY292aWQxOS1oYyDYp9mE2LHYo9izINin2YTYo9iu2LbYsTogYm9zdG9uLmdvdi9jb3ZpZDE5LWN2INin2YTYqNix2KrYutin2YTZitipOiBib3N0b24uZ292L2NvdmlkMTktcHQg2YHYsdmG2LPZijogYm9zdG9uLmdvdi9jb3ZpZDE5LWZyINi12YrZhtmJOiBib3N0b24uZ292L2NvdmlkMTktemgg2KfZhNmB2YrYqtmG2KfZhdmK2Kk6IGJvc3Rvbi5nb3YvY292aWQxOS12aSDYp9mE2LHZiNiz2YrYqTogYm9zdG9uLmdvdi9jb3ZpZDE5LXJ1INin2YTYtdmI2YXYp9mE2YrYqTogYm9zdG9uLmdvdi9jb3ZpZDE5LXNvINi52LHYqNmJOiBib3N0b24uZ292L2NvdmlkMTktYXIgU2VhcmNoIFNlYXJjaCBZb3UgYXJlIGhlcmUgSG9tZSDigLogRGVwYXJ0bWVudHMg4oC6IFNjaG9vbHMgU2Nob29scyBXZSBhcmUgY29tbWl0dGVkIHRvIHRyYW5zZm9ybWluZyB0aGUgbGl2ZXMgb2YgYWxsIGNoaWxkcmVuIHRocm91Z2ggZXhlbXBsYXJ5IHRlYWNoaW5nIGluIGEgd29ybGQtY2xhc3Mgc3lzdGVtIG9mIGlubm92YXRpdmUsIHdlbGNvbWluZyBzY2hvb2xzLiI7czoyOiJpZCI7czozMjoiOWI4MWE0NzZlNmU1MzIyYzM4YWQ0NTYzMWI0NjQ1YTMiO3M6NDoibGluayI7czo0MjoiaHR0cHM6Ly93d3cuYm9zdG9uLmdvdi9kZXBhcnRtZW50cy9zY2hvb2xzIjtzOjEwOiJsaW5rX3RpdGxlIjtzOjE0OiJ3d3cuYm9zdG9uLmdvdiI7czozOiJyZWYiO3M6MTYyOiJwcm9qZWN0cy82MTIwNDI2MTI1ODgvbG9jYXRpb25zL2dsb2JhbC9jb2xsZWN0aW9ucy9kZWZhdWx0X2NvbGxlY3Rpb24vZGF0YVN0b3Jlcy9kcnVwYWx3ZWJzaXRlXzE3MDI5MTkxMTk3NjgvYnJhbmNoZXMvMC9kb2N1bWVudHMvOWI4MWE0NzZlNmU1MzIyYzM4YWQ0NTYzMWI0NjQ1YTMiO3M6Nzoic3VtbWFyeSI7czoxNzI6IjxiPkJvc3RvbjwvYj4gUHVibGljIDxiPlNjaG9vbHM8L2I+IHBhcnRuZXJzIHdpdGggdGhlIGNvbW11bml0eSwgZmFtaWxpZXMsIGFuZCBzdHVkZW50cyB0byBkZXZlbG9wIGluIGV2ZXJ5IHN0dWRlbnQgdGhlIGtub3dsZWRnZSwgc2tpbGwsIGFuZCBjaGFyYWN0ZXIgdG8gZXhjZWwgaW4mbmJzcDsuLi4iO3M6NToidGl0bGUiO3M6MjA6IlNjaG9vbHMgfCBCb3N0b24uZ292Ijt9aToxO2E6Nzp7czo3OiJjb250ZW50IjtzOjIxNToiTGVhcm4gbW9yZSBNZWwgSC4gS2luZyBTb3V0aCBFbmQgQWNhZGVtaWVzIFRoZSBNZWwgSC4gS2luZyBTb3V0aCBFbmQgQWNhZGVtaWVzIChmb3JtZXJseSB0aGUgTWNLaW5sZXkgU2Nob29scykgc3RyZXRjaGVzIGFjcm9zcyB0aHJlZSBidWlsZGluZ3MsIGFsbCBvZiB3aGljaCBhcmUgc29tZSBvZiB0aGUgaGlnaGVzdC1uZWVkcyBzY2hvb2wgYnVpbGRpbmdzIGluIEJvc3Rvbi4iO3M6MjoiaWQiO3M6MzI6Ijk5OTJhYjUxYTdhNWYwNDAzNGFmODVhNDZkODEzZjVjIjtzOjQ6ImxpbmsiO3M6Njk6Imh0dHBzOi8vd3d3LmJvc3Rvbi5nb3YvZWR1Y2F0aW9uL2dyZWVuLW5ldy1kZWFsLWJvc3Rvbi1wdWJsaWMtc2Nob29scyI7czoxMDoibGlua190aXRsZSI7czoxNDoid3d3LmJvc3Rvbi5nb3YiO3M6MzoicmVmIjtzOjE2MjoicHJvamVjdHMvNjEyMDQyNjEyNTg4L2xvY2F0aW9ucy9nbG9iYWwvY29sbGVjdGlvbnMvZGVmYXVsdF9jb2xsZWN0aW9uL2RhdGFTdG9yZXMvZHJ1cGFsd2Vic2l0ZV8xNzAyOTE5MTE5NzY4L2JyYW5jaGVzLzAvZG9jdW1lbnRzLzk5OTJhYjUxYTdhNWYwNDAzNGFmODVhNDZkODEzZjVjIjtzOjc6InN1bW1hcnkiO3M6MTcyOiJFdmVyeSBzdHVkZW50IGluIDxiPkJvc3RvbjwvYj4gZGVzZXJ2ZXMgdG8gbGVhcm4gaW4gYSBzcGFjZSB0aGF0IGlzIHNhZmUsIGhlYWx0aHksIHJlc2lsaWVudCwgYW5kIGluc3BpcmluZy4gWWV0IG1hbnkgb2Ygb3VyIDxiPnNjaG9vbDwvYj4gYnVpbGRpbmdzIGxhY2sgdGhlIGJhc2ljJm5ic3A7Li4uIjtzOjU6InRpdGxlIjtzOjQyOiJBIEdyZWVuIE5ldyBEZWFsIGZvciBCb3N0b24gUHVibGljIFNjaG9vbHMiO31pOjI7YTo3OntzOjc6ImNvbnRlbnQiO3M6MjQ2OiIxLiBTYW11ZWwgQWRhbXMgRWxlbWVudGFyeSBTY2hvb2wgKEVhc3QgQm9zdG9uKSAyLiBEYW50ZSBBbGlnaGllcmkgTW9udGVzc29yaSBTY2hvb2wgKEVhc3QgQm9zdG9uKSAzLiBCb3N0b24gRGF5IGFuZCBFdmVuaW5nIEFjYWRlbXkgKFJveGJ1cnkpIDQuIER1ZGxleSBTdHJlZXQgTmVpZ2hib3Job29kIENoYXJ0ZXIgU2Nob29sIChSb3hidXJ5KSA1LiBEYXZpZCBBLiBFbGxpcyBFbGVtZW50YXJ5IFNjaG9vbCAoUm94YnVyeSkgNS4iO3M6MjoiaWQiO3M6MzI6IjZiYzFjOTBkOTQyODY1NjQ0NGQzM2QyNzhiNGE1MTA5IjtzOjQ6ImxpbmsiO3M6Nzc6Imh0dHBzOi8vd3d3LmJvc3Rvbi5nb3YvbmV3cy9mcmVzaC1mb29kLXByb2dyYW0tZXhwYW5kZWQtYm9zdG9uLXB1YmxpYy1zY2hvb2xzIjtzOjEwOiJsaW5rX3RpdGxlIjtzOjE0OiJ3d3cuYm9zdG9uLmdvdiI7czozOiJyZWYiO3M6MTYyOiJwcm9qZWN0cy82MTIwNDI2MTI1ODgvbG9jYXRpb25zL2dsb2JhbC9jb2xsZWN0aW9ucy9kZWZhdWx0X2NvbGxlY3Rpb24vZGF0YVN0b3Jlcy9kcnVwYWx3ZWJzaXRlXzE3MDI5MTkxMTk3NjgvYnJhbmNoZXMvMC9kb2N1bWVudHMvNmJjMWM5MGQ5NDI4NjU2NDQ0ZDMzZDI3OGI0YTUxMDkiO3M6Nzoic3VtbWFyeSI7czoxODk6Ii4uLiA8Yj5zY2hvb2w8L2I+IGNhZmV0ZXJpYSBzZXQtdXBzLiAmcXVvdDtOb3Qgb25seSBhcmUgd2UgcHJvdmlkaW5nIDxiPmJldHRlcjwvYj4gYWNjZXNzIHRvIGhlYWx0aHkgZm9vZCwgYnV0IG1vcmUgc3R1ZGVudHMgYXJlIGVhdGluZyB0aGUgZm9vZCBiZWNhdXNlIGl0JiMzOTtzIGRlbGljaW91cyBhbmQgdGhleSZuYnNwOy4uLiI7czo1OiJ0aXRsZSI7czo1MjoiRnJlc2ggZm9vZCBwcm9ncmFtIGV4cGFuZGVkIGF0IEJvc3RvbiBQdWJsaWMgU2Nob29scyI7fWk6MzthOjc6e3M6NzoiY29udGVudCI7czoyNDc6IkFzIHRoZSBwcmVtaWVyIFNURU0gaGlnaCBzY2hvb2wgaW4gTWFzc2FjaHVzZXR0cywgdGhlIE8mIzM5O0JyeWFudCB3aWxsIGNvbnRpbnVlIHRvIGF0dHJhY3Qgc3VzdGFpbmVkIGludGVyZXN0IGZyb20gcGFydG5lcnMgaW4gaGlnaGVyIGVkdWNhdGlvbiBhbmQgdGhlIHByaXZhdGUgYW5kIHB1YmxpYyBzZWN0b3JzLCBpbmNsdWRpbmcgZHVhbCBlbnJvbGxtZW50IG9wcG9ydHVuaXRpZXMgZm9yIE8mIzM5O0JyeWFudCBzdHVkZW50cy4iO3M6MjoiaWQiO3M6MzI6IjE5MTM5ZDk1ZTIxZjc1OTIyNjZjNmYwN2E2MGNhZGVkIjtzOjQ6ImxpbmsiO3M6NjM6Imh0dHBzOi8vd3d3LmJvc3Rvbi5nb3YvZWR1Y2F0aW9uL3dlc3Qtcm94YnVyeS1lZHVjYXRpb24tY29tcGxleCI7czoxMDoibGlua190aXRsZSI7czoxNDoid3d3LmJvc3Rvbi5nb3YiO3M6MzoicmVmIjtzOjE2MjoicHJvamVjdHMvNjEyMDQyNjEyNTg4L2xvY2F0aW9ucy9nbG9iYWwvY29sbGVjdGlvbnMvZGVmYXVsdF9jb2xsZWN0aW9uL2RhdGFTdG9yZXMvZHJ1cGFsd2Vic2l0ZV8xNzAyOTE5MTE5NzY4L2JyYW5jaGVzLzAvZG9jdW1lbnRzLzE5MTM5ZDk1ZTIxZjc1OTIyNjZjNmYwN2E2MGNhZGVkIjtzOjc6InN1bW1hcnkiO3M6MjEyOiJCeSBkcmF3aW5nIG9uIHRoZSA8Yj5iZXN0PC9iPiBleGFtcGxlcyBvZiBTVEVNIGhpZ2ggPGI+c2Nob29sczwvYj4sIDxiPmNvbGxlZ2VzPC9iPiAuLi4gPGI+U2Nob29sPC9iPiBmb3IgMiwwMDAgc3R1ZGVudHMuIFdlIGNvbmR1Y3RlZCAuLi4gPGI+Qm9zdG9uPC9iPiBMYXRpbiA8Yj5TY2hvb2w8L2I+IGFuZCA8Yj5Cb3N0b248L2I+IExhdGluIDxiPkFjYWRlbXk8L2I+LiI7czo1OiJ0aXRsZSI7czo0MzoiV2VzdCBSb3hidXJ5IEVkdWNhdGlvbiBDb21wbGV4IHwgQm9zdG9uLmdvdiI7fWk6NDthOjc6e3M6NzoiY29udGVudCI7czoyNDc6IkFzIHRoZSBwcmVtaWVyIFNURU0gaGlnaCBzY2hvb2wgaW4gTWFzc2FjaHVzZXR0cywgdGhlIE8mIzM5O0JyeWFudCB3aWxsIGNvbnRpbnVlIHRvIGF0dHJhY3Qgc3VzdGFpbmVkIGludGVyZXN0IGZyb20gcGFydG5lcnMgaW4gaGlnaGVyIGVkdWNhdGlvbiBhbmQgdGhlIHByaXZhdGUgYW5kIHB1YmxpYyBzZWN0b3JzLCBpbmNsdWRpbmcgZHVhbCBlbnJvbGxtZW50IG9wcG9ydHVuaXRpZXMgZm9yIE8mIzM5O0JyeWFudCBzdHVkZW50cy4iO3M6MjoiaWQiO3M6MzI6ImNjZjY2NmZhNDVkZDVjYmNhYTAyOWEyOGRlN2I2YzgxIjtzOjQ6ImxpbmsiO3M6Nzk6Imh0dHBzOi8vd3d3LmJvc3Rvbi5nb3YvZWR1Y2F0aW9uL25ldy1oaWdoLXNjaG9vbC13ZXN0LXJveGJ1cnktZWR1Y2F0aW9uLWNvbXBsZXgiO3M6MTA6ImxpbmtfdGl0bGUiO3M6MTQ6Ind3dy5ib3N0b24uZ292IjtzOjM6InJlZiI7czoxNjI6InByb2plY3RzLzYxMjA0MjYxMjU4OC9sb2NhdGlvbnMvZ2xvYmFsL2NvbGxlY3Rpb25zL2RlZmF1bHRfY29sbGVjdGlvbi9kYXRhU3RvcmVzL2RydXBhbHdlYnNpdGVfMTcwMjkxOTExOTc2OC9icmFuY2hlcy8wL2RvY3VtZW50cy9jY2Y2NjZmYTQ1ZGQ1Y2JjYWEwMjlhMjhkZTdiNmM4MSI7czo3OiJzdW1tYXJ5IjtzOjIxMjoiQnkgZHJhd2luZyBvbiB0aGUgPGI+YmVzdDwvYj4gZXhhbXBsZXMgb2YgU1RFTSBoaWdoIDxiPnNjaG9vbHM8L2I+LCA8Yj5jb2xsZWdlczwvYj4gLi4uIDxiPlNjaG9vbDwvYj4gZm9yIDIsMDAwIHN0dWRlbnRzLiBXZSBjb25kdWN0ZWQgLi4uIDxiPkJvc3RvbjwvYj4gTGF0aW4gPGI+U2Nob29sPC9iPiBhbmQgPGI+Qm9zdG9uPC9iPiBMYXRpbiA8Yj5BY2FkZW15PC9iPi4iO3M6NToidGl0bGUiO3M6NDM6Ildlc3QgUm94YnVyeSBFZHVjYXRpb24gQ29tcGxleCB8IEJvc3Rvbi5nb3YiO31pOjU7YTo3OntzOjc6ImNvbnRlbnQiO3M6NjcwOiJFYXJseSBDb2xsZWdlIGFuZCBJbm5vdmF0aW9uIFBhdGh3YXlzIGhhdmUgZGVtb25zdHJhdGVkIHN1Y2Nlc3MgaW4gQm9zdG9uIFB1YmxpYyBTY2hvb2xzIGluY2x1ZGluZzogQ2hhcmxlc3Rvd24gSGlnaCBTY2hvb2wsIHdoaWNoIGhhcyBFYXJseSBDb2xsZWdlIHByb2dyYW1zIGluIEJ1c2luZXNzLCBIZWFsdGggU2NpZW5jZXMgJmFtcDsgVGVjaCB3aXRoIEJ1bmtlciBIaWxsIENvbW11bml0eSBDb2xsZWdlOyBNYWRpc29uIFBhcmsgVGVjaG5pY2FsIFZvY2F0aW9uYWwgSGlnaCBTY2hvb2wsIHdoaWNoIGhhcyBhIEdlbmVyYWwgU3R1ZGllcyBFYXJseSBDb2xsZWdlIHByb2dyYW0gd2l0aCBSb3hidXJ5IENvbW11bml0eSBDb2xsZWdlICZhbXA7IEJ1bmtlciBIaWxsIENvbW11bml0eSBDb2xsZWdlOyBEZWFyYm9ybiBTVEVNIEFjYWRlbXksIHdoaWNoIGhhcyBJbm5vdmF0aW9uIFBhdGh3YXlzIGluIEVuZ2luZWVyaW5nICZhbXA7IENvbXB1dGVyIFNjaWVuY2UgYW5kIEVhcmx5IENvbGxlZ2UgcHJvZ3JhbXMgaW4gSGVhbHRoICZhbXA7IExpZmUgU2NpZW5jZXMgd2l0aCBXZW50d29ydGggSW5zdGl0dXRlIG9mIFRlY2hub2xvZ3k7IGFuZCBFeGNlbCBIaWdoIFNjaG9vbCwgd2hpY2ggaGFzIGFuIElubm92YXRpb24gUGF0aHdheXMgZm9yIGluZm9ybWF0aW9uIHRlY2hub2xvZ3kuIjtzOjI6ImlkIjtzOjMyOiJjNTBjYjQ1ZDRlM2MyN2QzMjc2YzczMmYzOThlMGU0NSI7czo0OiJsaW5rIjtzOjY1OiJodHRwczovL3d3dy5ib3N0b24uZ292L25ld3MvZWFybHktY29sbGVnZS1wcm9ncmFtLWV4cGFuZGVkLWJvc3RvbiI7czoxMDoibGlua190aXRsZSI7czoxNDoid3d3LmJvc3Rvbi5nb3YiO3M6MzoicmVmIjtzOjE2MjoicHJvamVjdHMvNjEyMDQyNjEyNTg4L2xvY2F0aW9ucy9nbG9iYWwvY29sbGVjdGlvbnMvZGVmYXVsdF9jb2xsZWN0aW9uL2RhdGFTdG9yZXMvZHJ1cGFsd2Vic2l0ZV8xNzAyOTE5MTE5NzY4L2JyYW5jaGVzLzAvZG9jdW1lbnRzL2M1MGNiNDVkNGUzYzI3ZDMyNzZjNzMyZjM5OGUwZTQ1IjtzOjc6InN1bW1hcnkiO3M6MjIxOiIuLi4gPGI+c2Nob29sPC9iPizigJ0gc2FpZCBCcmVuZGEgQ2Fzc2VsbGl1cywgU3VwZXJpbnRlbmRlbnQgb2YgPGI+Qm9zdG9uPC9iPiBQdWJsaWMgPGI+U2Nob29sczwvYj4uIC4uLiA8Yj5Cb3N0b248L2I+IFB1YmxpYyA8Yj5TY2hvb2xzPC9iPiAuLi4gQmFjayB0byA8Yj50b3A8L2I+LiBGb290ZXIgbWVudS4gUHJpdmFjeSBQb2xpY3kgJm1pZGRvdDsgQ29udGFjdCB1cyZuYnNwOy4uLiI7czo1OiJ0aXRsZSI7czo0MDoiRWFybHkgQ29sbGVnZSBQcm9ncmFtIEV4cGFuZGVkIGluIEJvc3RvbiI7fWk6NjthOjc6e3M6NzoiY29udGVudCI7czoxNDA6Ik1heW9yIFd1IGFuZCBTdXBlcmludGVuZGVudCBTa2lwcGVyIEFubm91bmNlIFZpc2lvbiBmb3IgQm9zdG9uIEhpZ2ggU2Nob29scyBhbmQgU3R1ZGVudCBTdWNjZXNzIE5vIHJlbGF0ZWQgcG9zdHMgYXJlIGF2YWlsYWJsZSBhdCB0aGlzIHRpbWUuIjtzOjI6ImlkIjtzOjMyOiI4OTgwMDQ0YTc5Y2Q1ZGEzMzhhZjRiMzIwODZhMDgwNyI7czo0OiJsaW5rIjtzOjc4OiJodHRwczovL3d3dy5ib3N0b24uZ292L2VkdWNhdGlvbi9tYWRpc29uLXBhcmstdGVjaG5pY2FsLXZvY2F0aW9uYWwtaGlnaC1zY2hvb2wiO3M6MTA6ImxpbmtfdGl0bGUiO3M6MTQ6Ind3dy5ib3N0b24uZ292IjtzOjM6InJlZiI7czoxNjI6InByb2plY3RzLzYxMjA0MjYxMjU4OC9sb2NhdGlvbnMvZ2xvYmFsL2NvbGxlY3Rpb25zL2RlZmF1bHRfY29sbGVjdGlvbi9kYXRhU3RvcmVzL2RydXBhbHdlYnNpdGVfMTcwMjkxOTExOTc2OC9icmFuY2hlcy8wL2RvY3VtZW50cy84OTgwMDQ0YTc5Y2Q1ZGEzMzhhZjRiMzIwODZhMDgwNyI7czo3OiJzdW1tYXJ5IjtzOjE3NDoiV2hhdCBpcyB0aGUgdmlzaW9uIGZvciB0aGUgTWFkaXNvbiBQYXJrIFJlZGVzaWduIGFuZCBSZW5vdmF0aW9uIHByb2plY3Q/ICZtaWRkb3Q7IFdoYXQgaXMgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiBPcHRpb25zIDEgYW5kIDIgaW4gdGhlIEZlYXNpYmlsaXR5IFN0dWR5IGFuZCBob3cgYXJlJm5ic3A7Li4uIjtzOjU6InRpdGxlIjtzOjU4OiJNYWRpc29uIFBhcmsgVGVjaG5pY2FsIFZvY2F0aW9uYWwgSGlnaCBTY2hvb2wgfCBCb3N0b24uZ292Ijt9aTo3O2E6Nzp7czo3OiJjb250ZW50IjtzOjE4ODoiSWYgc28sIHRoZXJlIGFyZSBtYW55IHByb2dyYW1zIGluIHRoZSBDaXR5IG9mIEJvc3RvbiB0byBtYWtlIHRoYXQgZHJlYW0gcG9zc2libGUsIHdoZXRoZXIgaXQmIzM5O3MgY29tbXVuaXR5IGNvbGxlZ2UsIGEgZm91ci15ZWFyIHVuaXZlcnNpdHksIG9yIGNvbnRpbnVpbmcgZWR1Y2F0aW9uLiBTdGlsbCBoYXZlIHF1ZXN0aW9ucz8iO3M6MjoiaWQiO3M6MzI6IjgyNDAyMDliNjIzOTlkZmJkMDkwOGNlNTIzZjc4MTY2IjtzOjQ6ImxpbmsiO3M6ODc6Imh0dHBzOi8vd3d3LmJvc3Rvbi5nb3YvZGVwYXJ0bWVudHMvbWF5b3JzLW9mZmljZS9oaWdoZXItZWR1Y2F0aW9uLWZ1bmRpbmctb3Bwb3J0dW5pdGllcyI7czoxMDoibGlua190aXRsZSI7czoxNDoid3d3LmJvc3Rvbi5nb3YiO3M6MzoicmVmIjtzOjE2MjoicHJvamVjdHMvNjEyMDQyNjEyNTg4L2xvY2F0aW9ucy9nbG9iYWwvY29sbGVjdGlvbnMvZGVmYXVsdF9jb2xsZWN0aW9uL2RhdGFTdG9yZXMvZHJ1cGFsd2Vic2l0ZV8xNzAyOTE5MTE5NzY4L2JyYW5jaGVzLzAvZG9jdW1lbnRzLzgyNDAyMDliNjIzOTlkZmJkMDkwOGNlNTIzZjc4MTY2IjtzOjc6InN1bW1hcnkiO3M6MjExOiJTY2hvbGFyc2hpcHMgZnJvbSA8Yj5Cb3N0b248L2I+LWFyZWEgPGI+U2Nob29sczwvYj4gOyBTdHVkZW50cyBhdHRlbmRpbmcgPGI+Qm9zdG9uPC9iPiBQdWJsaWMgSGlnaCA8Yj5TY2hvb2w8L2I+IGFuZCB3aG8gYXJlIGluIHRoZSA8Yj50b3A8L2I+IDEwIHBlcmNlbnQgb2YgdGhlaXIgaGlnaCA8Yj5zY2hvb2w8L2I+IGNsYXNzLiBTdHVkZW50cyBtdXN0Jm5ic3A7Li4uIjtzOjU6InRpdGxlIjtzOjUxOiJIaWdoZXIgZWR1Y2F0aW9uIGZ1bmRpbmcgb3Bwb3J0dW5pdGllcyB8IEJvc3Rvbi5nb3YiO31pOjg7YTo3OntzOjc6ImNvbnRlbnQiO3M6MjE3OiIsIERvSVQgbWEgeHVrdW1hYW4gdGF5YWRhIGFtYSBzYXggYWhhYW50YSB3YXh5YWFiYWhhIGxhIHRhcmp1bWF5LiBUYW5pIHdheGF5IGt1IGRhbWJheW4ga2FydGFhIHFvcmFhbCBhYW4gc2F4IGFoYXluIG9vIGxhIHRhcmp1bWF5LCBhbWEga2hhbGFkYWFkIGthbGUgb28ga3Ugc2FhYnNhbiBzYXdpcnJhZGEgaXlvIG11dXFhYWxrYSBndXVkIGVlIGJvZ2FnZ2EgbGEgdHVyanVtYXkuIjtzOjI6ImlkIjtzOjMyOiJmNTBkNDQ4MjBiYzRjNmYzMGU3MWExMmFhMDNmOTJiMyI7czo0OiJsaW5rIjtzOjEwMDoiaHR0cHM6Ly93d3cuYm9zdG9uLmdvdi9uZXdzL3dlc3QtZW5kcy13YXNoaW5ndG9uLXNjaG9vbC1sb29rLWJvc3RvbnMtcHVibGljLXNjaG9vbHMtcGFzdC1hbmQtcHJlc2VudCI7czoxMDoibGlua190aXRsZSI7czoxNDoid3d3LmJvc3Rvbi5nb3YiO3M6MzoicmVmIjtzOjE2MjoicHJvamVjdHMvNjEyMDQyNjEyNTg4L2xvY2F0aW9ucy9nbG9iYWwvY29sbGVjdGlvbnMvZGVmYXVsdF9jb2xsZWN0aW9uL2RhdGFTdG9yZXMvZHJ1cGFsd2Vic2l0ZV8xNzAyOTE5MTE5NzY4L2JyYW5jaGVzLzAvZG9jdW1lbnRzL2Y1MGQ0NDgyMGJjNGM2ZjMwZTcxYTEyYWEwM2Y5MmIzIjtzOjc6InN1bW1hcnkiO3M6MjAxOiJOb3JtYW4gU3RyZWV0IHNob3dpbmcgdGhlIFdhc2hpbmd0b24gPGI+U2Nob29sPC9iPiwgTWF5IDE5NjEsLiBUb2RheSwgdGhlcmUgYXJlIHNvbWUgdmVyeSBzaW1pbGFyIDxiPnByb2dyYW1zPC9iPiBzZXQgdXAgaW4gdGhlIDxiPkJvc3RvbjwvYj4gUHVibGljIDxiPlNjaG9vbHM8L2I+LiBTdW1tZXIgPGI+cHJvZ3JhbXM8L2I+IGxpa2UmbmJzcDsuLi4iO3M6NToidGl0bGUiO3M6OTg6IlRoZSBXZXN0IEVuZCdzIFdhc2hpbmd0b24gU2Nob29sOiBBIGxvb2sgYXQgQm9zdG9uJ3MgUHVibGljIFNjaG9vbHMsIHBhc3QgYW5kIHByZXNlbnQgfCBCb3N0b24uZ292Ijt9aTo5O2E6Nzp7czo3OiJjb250ZW50IjtzOjIxNzoiLCBEb0lUIG1hIHh1a3VtYWFuIHRheWFkYSBhbWEgc2F4IGFoYWFudGEgd2F4eWFhYmFoYSBsYSB0YXJqdW1heS4gVGFuaSB3YXhheSBrdSBkYW1iYXluIGthcnRhYSBxb3JhYWwgYWFuIHNheCBhaGF5biBvbyBsYSB0YXJqdW1heSwgYW1hIGtoYWxhZGFhZCBrYWxlIG9vIGt1IHNhYWJzYW4gc2F3aXJyYWRhIGl5byBtdXVxYWFsa2EgZ3V1ZCBlZSBib2dhZ2dhIGxhIHR1cmp1bWF5LiI7czoyOiJpZCI7czozMjoiMjY3NWFhZDQwMTRkMjFlN2VlYjkxMTJkYjgyZjcxOGUiO3M6NDoibGluayI7czo0NjoiaHR0cHM6Ly93d3cuYm9zdG9uLmdvdi9lZHVjYXRpb24vY2FydGVyLXNjaG9vbCI7czoxMDoibGlua190aXRsZSI7czoxNDoid3d3LmJvc3Rvbi5nb3YiO3M6MzoicmVmIjtzOjE2MjoicHJvamVjdHMvNjEyMDQyNjEyNTg4L2xvY2F0aW9ucy9nbG9iYWwvY29sbGVjdGlvbnMvZGVmYXVsdF9jb2xsZWN0aW9uL2RhdGFTdG9yZXMvZHJ1cGFsd2Vic2l0ZV8xNzAyOTE5MTE5NzY4L2JyYW5jaGVzLzAvZG9jdW1lbnRzLzI2NzVhYWQ0MDE0ZDIxZTdlZWI5MTEyZGI4MmY3MThlIjtzOjc6InN1bW1hcnkiO3M6MTYxOiIuLi4gdGhlcmFwZXV0aWMgcG9vbCwgc2Vuc29yeSBnYXJkZW4sIHJvb2Z0b3AgY2xhc3Nyb29tLCBhbmQgPGI+YmV0dGVyPC9iPiBzcGFjZSBkZXNpZ25lZCBzcGVjaWZpY2FsbHkgZm9yIHN0dWRlbnRzIHdpdGggZGlzYWJpbGl0aWVzIGFuZCBjb21wbGV4IGxlYXJuaW5nIG5lZWRzLiI7czo1OiJ0aXRsZSI7czoyNjoiQ2FydGVyIFNjaG9vbCB8IEJvc3Rvbi5nb3YiO319czoxNToiY29udmVyc2F0aW9uX2lkIjtzOjE5OiIzMjQyMDczNjg5OTA1ODU3MDU5Ijt9");
    return unserialize($a);
  }

  /**
   * @inheritDoc
   */
  public function availablePrompts(): array {
    return $this->vertex->availablePrompts();
  }

}
