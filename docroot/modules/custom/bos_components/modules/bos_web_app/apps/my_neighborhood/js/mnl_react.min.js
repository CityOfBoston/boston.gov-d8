"use strict";function ownKeys(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,i)}return s}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(s),!0).forEach(function(t){_defineProperty(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):ownKeys(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}function _defineProperty(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class MNL extends React.Component{constructor(e){super(e),_defineProperty(this,"setDefaults",()=>{this.setState({error:null,isLoading:!1,isLoadingRecollect:null,itemsLookup:[],itemsDisplay:null,itemsRecollect:[],currentKeywords:"",submittedAddress:null,submittedKeywords:null}),history.pushState(null,null,configProps.path)}),_defineProperty(this,"setCheckLocalStorage",(e,t,s)=>{if(localStorage.getItem("sam_data")){let e=JSON.parse(localStorage.getItem("sam_data"));this.displayAddress(e[0].sam_id,e[0].sam_address,e[0].section),null!==e[0].section&&this.setState({section:e[0].section})}else{let i=[{sam_id:e||null,sam_address:t||null,section:s||null}];localStorage.setItem("sam_data",JSON.stringify(i))}}),_defineProperty(this,"scaleInputText",e=>{jQuery(".resize").textfill({maxFontPixels:75,success:function(){let e=jQuery(".resize span").css("fontSize");jQuery("#web-app input").css("font-size",e)}})}),_defineProperty(this,"handleKeywordChange",e=>{e.preventDefault();let t,s=e.target.value.length;this.setState({currentKeywords:e.target.value,submittedKeywords:null,searchColor:null}),(s>=5||13===e.keyCode)&&(this.setState({isLoading:!0,submittedKeywords:!0,submittedAddress:null}),clearTimeout(t),t=setTimeout(this.lookupAddress(),3e3)),this.scaleInputText()}),_defineProperty(this,"handleKeywordSubmit",e=>{e.preventDefault(),this.setState({isLoading:!0,submittedKeywords:!0,submittedAddress:null}),this.lookupAddress(),this.scaleInputText()}),_defineProperty(this,"lookupRecollect",e=>{let t={address:this.state.submittedAddress};fetch("rest/recollect",{method:"POST",body:JSON.stringify(t)}).then(e=>e.json()).then(e=>{e.response?this.setState({isLoadingRecollect:!1,itemsRecollect:e.response.next_event}):this.setState({itemsRecollect:null})},e=>{this.setState({itemsRecollect:"error",error:e})})}),_defineProperty(this,"lookupAddress",e=>{let t=this.state.currentKeywords;fetch("/jsonapi/node/neighborhood_lookup?filter"+"[field_sam_address][operator]=CONTAINS"+"&filter"+("[field_sam_address][value]="+t)+"&fields"+"[node--neighborhood_lookup]=field_sam_address,field_sam_id"+"&page[limit]="+"5").then(e=>e.json()).then(e=>{e.data.length>0?this.setState({isLoading:!1,itemsLookup:e.data}):this.setState({isLoading:!1,itemsLookup:[]})},e=>{this.setState({isLoading:!1,error:e})})}),_defineProperty(this,"displayAddress",(e,t,s)=>{this.setState({isLoading:!0,isLoadingRecollect:!0,searchColor:"#288BE4",section:null,sam_id:e,currentKeywords:t});let i="none";fetch("/jsonapi/node/neighborhood_lookup?filter"+("[field_sam_id][value]="+e)+"&fields"+"[node--neighborhood_lookup]=field_sam_id,field_sam_neighborhood_data,field_sam_address").then(e=>e.json()).then(e=>{if(e.data[0]){i=JSON.parse(e.data[0].attributes.field_sam_neighborhood_data);let t=_objectSpread({},this.state.itemsDisplay);t.data=i,this.setState({isLoading:!1,submittedAddress:e.data[0].attributes.field_sam_address,submittedKeywords:!1,itemsLookup:[],itemsDisplay:t.data}),this.lookupRecollect(),this.scaleInputText(),localStorage.removeItem("sam_data"),this.setCheckLocalStorage(this.state.sam_id,this.state.submittedAddress,s)}else this.setState({itemsDisplay:null,isLoading:!1})},e=>{this.setState({isLoading:!1,itemsDisplay:null,error:e})})}),_defineProperty(this,"displaySection",e=>{this.setState({section:e}),localStorage.removeItem("sam_data"),this.setCheckLocalStorage(this.state.sam_id,this.state.submittedAddress,e)}),this.state={error:null,isLoading:!1,isLoadingRecollect:null,season:configProps.season,earlyVoting:configProps.earlyVoting,section:null,sam_id:null,itemsLookup:[],itemsDisplay:null,itemsRecollect:[],currentKeywords:null,submittedAddress:null,submittedKeywords:null,searchColor:null}}componentDidMount(){let e=jQuery("#web-app input").height(),t=jQuery("#web-app input").width()-75;jQuery(".resize").css("height",e+"px"),jQuery(".resize").css("width",t+"px"),jQuery("#web-app input").css("height",e+"px");let s=this;window.addEventListener("popstate",function(e){null!==s.state.submittedAddress&&null!==s.state.section?s.displaySection(null):null!==s.state.submittedAddress&&null==s.state.section&&s.setDefaults()},!1),this.setCheckLocalStorage()}render(){let e,t=this.state.itemsLookup,s=[];if(this.state.submittedKeywords)if(t.length>0)for(const[i,a]of t.entries())e=React.createElement("button",{className:"cd dl-i",tabIndex:"0",style:{cursor:"pointer"},onClick:this.displayAddress.bind(this,t[i].attributes.field_sam_id,t[i].attributes.field_sam_address,null),key:i},React.createElement("li",{className:"css-1tksw0t"},React.createElement("div",{className:"mnl-address addr addr--s",style:{whiteSpace:"pre-line",display:"inline-block",verticalAlign:"middle",lineHeight:"1.4"}},t[i].attributes.field_sam_address),React.createElement("div",{style:{clear:"both"}}))),s.push(e);else s=React.createElement("div",{className:"supporting-text"},"No address was found by that name.");let i=this.state.isLoadingRecollect?null:this.state.itemsRecollect.day,a=this.state.isLoadingRecollect?null:this.state.itemsRecollect.flags,o=this.state.submittedAddress?React.createElement("div",null,history.pushState({id:"sections"},"",configProps.path+"?p2"),React.createElement("div",{className:"g"},React.createElement(CityServices,{recollect_date:i,recollect_services:a,section:this.state.section,displaySection:this.displaySection}),React.createElement(CitySpaces,{library_branch:this.state.itemsDisplay.public_libraries_branch,library_address:this.state.itemsDisplay.public_libraries_address,library_zipcode:this.state.itemsDisplay.public_libraries_zipcode,comm_center:this.state.itemsDisplay.community_centers_name,comm_address:this.state.itemsDisplay.community_centers_address,comm_hours:this.state.itemsDisplay.community_centers_school_year_hours,comm_summer_hours:this.state.itemsDisplay.community_centers_summer_hours,park_name:this.state.itemsDisplay.parks_name,park_district:this.state.itemsDisplay.parks_district,park_ownership:this.state.itemsDisplay.parks_ownership,park_type:this.state.itemsDisplay.parks_type,hist_name:this.state.itemsDisplay.historic_districts_name,hist_place_name:this.state.itemsDisplay.historic_districts_place_name,hist_status:this.state.itemsDisplay.historic_districts_status,hist_year:this.state.itemsDisplay.historic_districts_year,hist_use_type:this.state.itemsDisplay.historic_districts_use_type,zoning_district:this.state.itemsDisplay.zoning_districts_district,section:this.state.section,displaySection:this.displaySection}),React.createElement(Representation,{councilor:this.state.itemsDisplay.city_council_councilor,district:this.state.itemsDisplay.city_council_district,councilor_image:this.state.itemsDisplay.city_council_image,councilor_webpage:this.state.itemsDisplay.city_council_webpage,liason_name:this.state.itemsDisplay.ons_liaison_name,liason_image:this.state.itemsDisplay.ons_liaison_pic_url,liason_webpage:this.state.itemsDisplay.ons_liaison_webpage,liason_neighborhood:this.state.itemsDisplay.ons_liaison_neighborhood,voting_location:this.state.itemsDisplay.polling_locations_location2,voting_address:this.state.itemsDisplay.polling_locations_location3,early_voting_active:this.state.earlyVoting,early_voting_dates:this.state.itemsDisplay.early_voting_dates,early_voting_times:this.state.itemsDisplay.early_voting_times,early_voting_address:this.state.itemsDisplay.early_voting_address,early_voting_location:this.state.itemsDisplay.early_voting_location,early_voting_neighborhood:this.state.itemsDisplay.early_voting_neighborhood,early_voting_notes:this.state.itemsDisplay.early_voting_notes,ward:this.state.itemsDisplay.ward_name,precinct:this.state.itemsDisplay.precincts_name,section:this.state.section,displaySection:this.displaySection}),"summer"==this.state.season||null==this.state.season?React.createElement(SummerResources,{tot_name:this.state.itemsDisplay.tot_sprays_name,tot_address:this.state.itemsDisplay.tot_sprays_address,bcyf_pool_center_name:this.state.itemsDisplay.bcyf_pool_centers_name,bcyf_pool_center_address:this.state.itemsDisplay.bcyf_pool_centers_address,bcyf_pool_center_hours:this.state.itemsDisplay.bcyf_pool_centers_school_year_hours,bcyf_pool_center_hours_summer:this.state.itemsDisplay.bcyf_pool_centers_summer_hours,section:this.state.section,displaySection:this.displaySection}):null,"winter"==this.state.season||null==this.state.season?React.createElement(WinterResources,{snow_routes:this.state.itemsDisplay.snow_routes_name,snow_routes_respsonsibility:this.state.itemsDisplay.snow_routes_responsibility,snow_parking_lots_name:this.state.itemsDisplay.snow_parking_lots_name,snow_parking_lots_address:this.state.itemsDisplay.snow_parking_lots_address,snow_parking_lots_fee:this.state.itemsDisplay.snow_parking_lots_fee,snow_parking_lots_comments:this.state.itemsDisplay.snow_parking_lots_comments,section:this.state.section,displaySection:this.displaySection}):null,React.createElement(Newsletter,{section:this.state.section}),React.createElement(Bos311,{section:this.state.section}))):"";return React.createElement("div",{className:"paragraphs-items paragraphs-items-field-components paragraphs-items-full paragraphs-items-field-components-full mnl"},React.createElement("div",null,React.createElement(Search,{handleKeywordChange:this.handleKeywordChange,handleKeywordSubmit:this.handleKeywordSubmit,placeholder:"Enter your address",searchClass:"sf-i-f",styleInline:{color:this.state.searchColor},currentKeywords:this.state.currentKeywords})),React.createElement("div",{style:{paddingTop:"50px"}},this.state.isLoading?React.createElement("div",{className:"supporting-text"},"Loading ... "):React.createElement("div",null,React.createElement("ul",{className:"dl"},s),React.createElement("div",null,o))),React.createElement("div",null," "))}}ReactDOM.render(React.createElement(MNL,null),document.getElementById("web-app"));