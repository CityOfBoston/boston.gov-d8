"use strict";function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var s=[],i=!0,a=!1,r=void 0;try{for(var o,n=e[Symbol.iterator]();!(i=(o=n.next()).done)&&(s.push(o.value),!t||s.length!==t);i=!0);}catch(e){a=!0,r=e}finally{try{i||null==n.return||n.return()}finally{if(a)throw r}}return s}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper(e,t){var s;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(s=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){s&&(e=s);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,n=!1;return{s:function(){s=e[Symbol.iterator]()},n:function(){var e=s.next();return o=e.done,e},e:function(e){n=!0,r=e},f:function(){try{o||null==s.return||s.return()}finally{if(n)throw r}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);return"Object"===s&&e.constructor&&(s=e.constructor.name),"Map"===s||"Set"===s?Array.from(e):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,i=new Array(t);s<t;s++)i[s]=e[s];return i}function ownKeys(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,i)}return s}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(s),!0).forEach(function(t){_defineProperty(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):ownKeys(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,s){return t&&_defineProperties(e.prototype,t),s&&_defineProperties(e,s),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var s,i=_getPrototypeOf(e);if(t){var a=_getPrototypeOf(this).constructor;s=Reflect.construct(i,arguments,a)}else s=i.apply(this,arguments);return _possibleConstructorReturn(this,s)}}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _defineProperty(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var MNL=function(e){_inherits(s,React.Component);var t=_createSuper(s);function s(e){var i;return _classCallCheck(this,s),_defineProperty(_assertThisInitialized(i=t.call(this,e)),"setDefaults",function(){i.setState({error:null,isLoading:!1,isLoadingRecollect:null,itemsLookup:[],itemsDisplay:null,itemsRecollect:[],currentKeywords:"",submittedAddress:null,submittedKeywords:null}),history.pushState(null,null,configProps.path)}),_defineProperty(_assertThisInitialized(i),"setCheckLocalStorage",function(e,t,s){if(localStorage.getItem("sam_data")){var a=JSON.parse(localStorage.getItem("sam_data"));i.displayAddress(a[0].sam_id,a[0].sam_address,a[0].section),null!==a[0].section&&i.setState({section:a[0].section})}else{var r=[{sam_id:e||null,sam_address:t||null,section:s||null}];localStorage.setItem("sam_data",JSON.stringify(r))}}),_defineProperty(_assertThisInitialized(i),"scaleInputText",function(e){jQuery(".resize").textfill({maxFontPixels:75,success:function(){var e=jQuery(".resize span").css("fontSize");jQuery("#web-app input").css("font-size",e)}})}),_defineProperty(_assertThisInitialized(i),"handleKeywordChange",function(e){e.preventDefault();var t,s=e.target.value.length;i.setState({currentKeywords:e.target.value,submittedKeywords:null,searchColor:null}),(s>=5||13===e.keyCode)&&(i.setState({isLoading:!0,submittedKeywords:!0,submittedAddress:null}),clearTimeout(t),t=setTimeout(i.lookupAddress(),3e3)),i.scaleInputText()}),_defineProperty(_assertThisInitialized(i),"handleKeywordSubmit",function(e){e.preventDefault(),i.setState({isLoading:!0,submittedKeywords:!0,submittedAddress:null}),i.lookupAddress(),i.scaleInputText()}),_defineProperty(_assertThisInitialized(i),"lookupRecollect",function(e){var t={address:i.state.submittedAddress};fetch("rest/recollect",{method:"POST",body:JSON.stringify(t)}).then(function(e){return e.json()}).then(function(e){e.response?i.setState({isLoadingRecollect:!1,itemsRecollect:e.response.next_event}):i.setState({itemsRecollect:null})},function(e){i.setState({itemsRecollect:"error",error:e})})}),_defineProperty(_assertThisInitialized(i),"lookupAddress",function(e){var t=i.state.currentKeywords;fetch("/jsonapi/node/neighborhood_lookup?filter"+"[field_sam_address][operator]=CONTAINS"+"&filter"+("[field_sam_address][value]="+t)+"&fields"+"[node--neighborhood_lookup]=field_sam_address,field_sam_id"+"&page[limit]="+"5").then(function(e){return e.json()}).then(function(e){e.data.length>0?i.setState({isLoading:!1,itemsLookup:e.data}):i.setState({isLoading:!1,itemsLookup:[]})},function(e){i.setState({isLoading:!1,error:e})})}),_defineProperty(_assertThisInitialized(i),"displayAddress",function(e,t,s){i.setState({isLoading:!0,isLoadingRecollect:!0,searchColor:"#288BE4",section:null,sam_id:e,currentKeywords:t});var a="none";fetch("/jsonapi/node/neighborhood_lookup?filter"+("[field_sam_id][value]="+e)+"&fields"+"[node--neighborhood_lookup]=field_sam_id,field_sam_neighborhood_data,field_sam_address").then(function(e){return e.json()}).then(function(e){if(e.data[0]){a=JSON.parse(e.data[0].attributes.field_sam_neighborhood_data);var t=_objectSpread({},i.state.itemsDisplay);t.data=a,i.setState({isLoading:!1,submittedAddress:e.data[0].attributes.field_sam_address,submittedKeywords:!1,itemsLookup:[],itemsDisplay:t.data}),i.lookupRecollect(),i.scaleInputText(),localStorage.removeItem("sam_data"),i.setCheckLocalStorage(i.state.sam_id,i.state.submittedAddress,s)}else i.setState({itemsDisplay:null,isLoading:!1})},function(e){i.setState({isLoading:!1,itemsDisplay:null,error:e})})}),_defineProperty(_assertThisInitialized(i),"displaySection",function(e){i.setState({section:e}),localStorage.removeItem("sam_data"),i.setCheckLocalStorage(i.state.sam_id,i.state.submittedAddress,e)}),i.state={error:null,isLoading:!1,isLoadingRecollect:null,season:configProps.season,earlyVoting:configProps.earlyVoting,section:null,sam_id:null,itemsLookup:[],itemsDisplay:null,itemsRecollect:[],currentKeywords:null,submittedAddress:null,submittedKeywords:null,searchColor:null},i}return _createClass(s,[{key:"componentDidMount",value:function(){var e=jQuery("#web-app input").height(),t=jQuery("#web-app input").width()-75;jQuery(".resize").css("height",e+"px"),jQuery(".resize").css("width",t+"px"),jQuery("#web-app input").css("height",e+"px");var s=this;window.addEventListener("popstate",function(e){null!==s.state.submittedAddress&&null!==s.state.section?s.displaySection(null):null!==s.state.submittedAddress&&null==s.state.section&&s.setDefaults()},!1),this.setCheckLocalStorage()}},{key:"render",value:function(){var e,t=this.state.itemsLookup,s=[];if(this.state.submittedKeywords)if(t.length>0){var i,a=_createForOfIteratorHelper(t.entries());try{for(a.s();!(i=a.n()).done;){var r=_slicedToArray(i.value,2),o=r[0];r[1];e=React.createElement("button",{className:"cd dl-i",tabIndex:"0",style:{cursor:"pointer"},onClick:this.displayAddress.bind(this,t[o].attributes.field_sam_id,t[o].attributes.field_sam_address,null),key:o},React.createElement("li",{className:"css-1tksw0t"},React.createElement("div",{className:"mnl-address addr addr--s",style:{whiteSpace:"pre-line",display:"inline-block",verticalAlign:"middle",lineHeight:"1.4"}},t[o].attributes.field_sam_address),React.createElement("div",{style:{clear:"both"}}))),s.push(e)}}catch(e){a.e(e)}finally{a.f()}}else s=React.createElement("div",{className:"supporting-text"},"No address was found by that name.");var n=this.state.isLoadingRecollect?null:this.state.itemsRecollect.day,l=this.state.isLoadingRecollect?null:this.state.itemsRecollect.flags,c=this.state.submittedAddress?React.createElement("div",null,history.pushState({id:"sections"},"",configProps.path+"?p2"),React.createElement("div",{className:"g"},React.createElement(CityServices,{recollect_date:n,recollect_services:l,section:this.state.section,displaySection:this.displaySection}),React.createElement(CitySpaces,{library_branch:this.state.itemsDisplay.public_libraries_branch,library_address:this.state.itemsDisplay.public_libraries_address,library_zipcode:this.state.itemsDisplay.public_libraries_zipcode,comm_center:this.state.itemsDisplay.community_centers_name,comm_address:this.state.itemsDisplay.community_centers_address,comm_hours:this.state.itemsDisplay.community_centers_school_year_hours,comm_summer_hours:this.state.itemsDisplay.community_centers_summer_hours,park_name:this.state.itemsDisplay.parks_name,park_district:this.state.itemsDisplay.parks_district,park_ownership:this.state.itemsDisplay.parks_ownership,park_type:this.state.itemsDisplay.parks_type,hist_name:this.state.itemsDisplay.historic_districts_name,hist_place_name:this.state.itemsDisplay.historic_districts_place_name,hist_status:this.state.itemsDisplay.historic_districts_status,hist_year:this.state.itemsDisplay.historic_districts_year,hist_use_type:this.state.itemsDisplay.historic_districts_use_type,zoning_district:this.state.itemsDisplay.zoning_districts_district,section:this.state.section,displaySection:this.displaySection}),React.createElement(Representation,{councilor:this.state.itemsDisplay.city_council_councilor,district:this.state.itemsDisplay.city_council_district,councilor_image:this.state.itemsDisplay.city_council_image,councilor_webpage:this.state.itemsDisplay.city_council_webpage,liason_name:this.state.itemsDisplay.ons_liaison_name,liason_image:this.state.itemsDisplay.ons_liaison_pic_url,liason_webpage:this.state.itemsDisplay.ons_liaison_webpage,liason_neighborhood:this.state.itemsDisplay.ons_liaison_neighborhood,voting_location:this.state.itemsDisplay.polling_locations_location2,voting_address:this.state.itemsDisplay.polling_locations_location3,early_voting_active:this.state.earlyVoting,early_voting_dates:this.state.itemsDisplay.early_voting_dates,early_voting_times:this.state.itemsDisplay.early_voting_times,early_voting_address:this.state.itemsDisplay.early_voting_address,early_voting_location:this.state.itemsDisplay.early_voting_location,early_voting_neighborhood:this.state.itemsDisplay.early_voting_neighborhood,early_voting_notes:this.state.itemsDisplay.early_voting_notes,ward:this.state.itemsDisplay.ward_name,precinct:this.state.itemsDisplay.precincts_name,section:this.state.section,displaySection:this.displaySection}),React.createElement(PublicSafety,{police_station_name:this.state.itemsDisplay.police_dept_police_station,police_station_address:this.state.itemsDisplay.police_dept_address,police_station_neighborhood:this.state.itemsDisplay.police_dept_neighborhood,police_station_zip:this.state.itemsDisplay.police_dept_zip,police_district:this.state.itemsDisplay.police_district,fire_station_name:this.state.itemsDisplay.fire_dept_name,fire_station_address:this.state.itemsDisplay.fire_dept_address,fire_station_neighborhood:this.state.itemsDisplay.fire_dept_neighborhood,recollect_services:l,section:this.state.section,displaySection:this.displaySection}),"summer"==this.state.season||null==this.state.season?React.createElement(SummerResources,{tot_name:this.state.itemsDisplay.tot_sprays_name,tot_address:this.state.itemsDisplay.tot_sprays_address,bcyf_pool_center_name:this.state.itemsDisplay.bcyf_pool_centers_name,bcyf_pool_center_address:this.state.itemsDisplay.bcyf_pool_centers_address,bcyf_pool_center_hours:this.state.itemsDisplay.bcyf_pool_centers_school_year_hours,bcyf_pool_center_hours_summer:this.state.itemsDisplay.bcyf_pool_centers_summer_hours,section:this.state.section,displaySection:this.displaySection}):null,"winter"==this.state.season||null==this.state.season?React.createElement(WinterResources,{snow_routes:this.state.itemsDisplay.snow_routes_name,snow_routes_respsonsibility:this.state.itemsDisplay.snow_routes_responsibility,snow_parking_lots_name:this.state.itemsDisplay.snow_parking_lots_name,snow_parking_lots_address:this.state.itemsDisplay.snow_parking_lots_address,snow_parking_lots_fee:this.state.itemsDisplay.snow_parking_lots_fee,snow_parking_lots_comments:this.state.itemsDisplay.snow_parking_lots_comments,section:this.state.section,displaySection:this.displaySection}):null,React.createElement(Newsletter,{section:this.state.section}),React.createElement(Bos311,{section:this.state.section}))):"";return React.createElement("div",{className:"paragraphs-items paragraphs-items-field-components paragraphs-items-full paragraphs-items-field-components-full mnl"},React.createElement("div",null,React.createElement(Search,{handleKeywordChange:this.handleKeywordChange,handleKeywordSubmit:this.handleKeywordSubmit,placeholder:"Enter your address",searchClass:"sf-i-f",styleInline:{color:this.state.searchColor},currentKeywords:this.state.currentKeywords})),React.createElement("div",{style:{paddingTop:"50px"}},this.state.isLoading?React.createElement("div",{className:"supporting-text"},"Loading ... "):React.createElement("div",null,React.createElement("ul",{className:"dl"},s),React.createElement("div",null,c))))}}]),s}();ReactDOM.render(React.createElement(MNL,null),document.getElementById("web-app"));