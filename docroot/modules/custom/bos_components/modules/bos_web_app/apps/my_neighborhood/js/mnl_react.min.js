var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i])}return t};class MNL extends React.Component{constructor(t){super(t),this.setDefaults=(()=>{this.setState({error:null,isLoading:!1,isLoadingRecollect:null,itemsLookup:[],itemsDisplay:null,itemsRecollect:[],currentKeywords:"",submittedAddress:null,submittedKeywords:null}),!configProps.frame_google()&&history.pushState(null,null,configProps.globals.path)}),this.setCheckLocalStorage=((t,e,s)=>{if(!configProps.frame_google())if(localStorage.getItem("sam_data")){let t=JSON.parse(localStorage.getItem("sam_data"));this.displayAddress(t[0].sam_id,t[0].sam_address,t[0].section),null!==t[0].section&&this.setState({section:t[0].section})}else{let i=[{sam_id:t||null,sam_address:e||null,section:s||null}];localStorage.setItem("sam_data",JSON.stringify(i))}}),this.scaleInputText=(t=>{jQuery(".resize").textfill({maxFontPixels:75,success:function(){let t=jQuery(".resize span").css("fontSize");jQuery("#web-app input").css("font-size",t)}})}),this.handleKeywordChange=(t=>{t.preventDefault();let e,s=t.target.value.length;this.setState({currentKeywords:t.target.value,submittedKeywords:null,searchColor:null}),(s>=5||13===t.keyCode)&&(this.setState({isLoading:!0,submittedKeywords:!0,submittedAddress:null}),clearTimeout(e),e=setTimeout(this.lookupAddress(),3e3)),this.scaleInputText()}),this.handleKeywordSubmit=(t=>{t.preventDefault(),this.setState({isLoading:!0,submittedKeywords:!0,submittedAddress:null}),this.lookupAddress(),this.scaleInputText()}),this.lookupRecollect=(t=>{let e={address:this.state.submittedAddress};fetch("rest/recollect",{method:"POST",body:JSON.stringify(e)}).then(t=>t.json()).then(t=>{t.response&&t.response.events.length>0?this.setState({isLoadingRecollect:!1,itemsRecollect:t.response.events}):this.setState({itemsRecollect:null})},t=>{this.setState({itemsRecollect:"error",error:t})})}),this.lookupAddress=(t=>{let e=this.state.currentKeywords;fetch("/jsonapi/node/neighborhood_lookup?filter"+"[field_sam_address][operator]=CONTAINS"+"&filter"+("[field_sam_address][value]="+e)+"&fields"+"[node--neighborhood_lookup]=field_sam_address,field_sam_id"+"&page[limit]="+"10"+"&sort="+"field_sam_address",{credentials:"include",mode:"cors",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"https://translate.googleusercontent.com"}}).then(t=>t.json()).then(t=>{t.data.length>0?this.setState({isLoading:!1,itemsLookup:t.data}):this.setState({isLoading:!1,itemsLookup:[]})},t=>{this.setState({isLoading:!1,error:t})})}),this.displayAddress=((t,e,s)=>{this.setState({isLoading:!0,isLoadingRecollect:!0,searchColor:"#288BE4",section:null,sam_id:t,currentKeywords:e});let i="none";fetch("/jsonapi/node/neighborhood_lookup?filter"+("[field_sam_id][value]="+t)+"&fields"+"[node--neighborhood_lookup]=field_sam_id,field_sam_neighborhood_data,field_sam_address",{credentials:"include",mode:"cors",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"https://translate.googleusercontent.com"}}).then(t=>t.json()).then(t=>{if(t.data[0]){i=JSON.parse(t.data[0].attributes.field_sam_neighborhood_data);let e=_extends({},this.state.itemsDisplay);e.data=i,this.setState({isLoading:!1,submittedAddress:t.data[0].attributes.field_sam_address,submittedKeywords:!1,itemsLookup:[],itemsDisplay:e.data}),this.lookupRecollect(),this.scaleInputText(),localStorage.removeItem("sam_data"),this.setCheckLocalStorage(this.state.sam_id,this.state.submittedAddress,s)}else this.setState({itemsDisplay:null,isLoading:!1})},t=>{this.setState({isLoading:!1,itemsDisplay:null,error:t})})}),this.displaySection=((t,e)=>{(e&&13===e.keyCode||null==e)&&(this.setState({section:t}),localStorage.removeItem("sam_data"),this.setCheckLocalStorage(this.state.sam_id,this.state.submittedAddress,t))}),this.state={error:null,isLoading:!1,isLoadingRecollect:null,section:null,sam_id:null,itemsLookup:[],itemsDisplay:null,itemsRecollect:[],currentKeywords:null,submittedAddress:null,submittedKeywords:null,searchColor:null}}componentDidMount(){let t=jQuery("#web-app input").height(),e=jQuery("#web-app input").width()-75;jQuery(".resize").css("height",t+"px"),jQuery(".resize").css("width",e+"px"),jQuery("#web-app input").css("height",t+"px");let s=this;window.addEventListener("popstate",function(t){null!==s.state.submittedAddress&&null!==s.state.section?s.displaySection(null):null!==s.state.submittedAddress&&null==s.state.section&&s.setDefaults()},!1),this.setCheckLocalStorage()}render(){let t,e=this.state.itemsLookup,s=[];if(this.state.submittedKeywords)if(e.length>0)for(const[i,a]of e.entries())t=React.createElement("button",{className:"cd dl-i",tabIndex:"0",style:{cursor:"pointer"},onClick:this.displayAddress.bind(this,e[i].attributes.field_sam_id,e[i].attributes.field_sam_address,null),key:i},React.createElement("li",{className:"css-1tksw0t"},React.createElement("div",{className:"mnl-address addr addr--s",style:{whiteSpace:"pre-line",display:"inline-block",verticalAlign:"middle",lineHeight:"1.4"}},e[i].attributes.field_sam_address),React.createElement("div",{style:{clear:"both"}}))),s.push(t);else s=React.createElement("div",{className:"supporting-text"},"No address was found by that name.");let i=this.state.isLoadingRecollect?null:this.state.itemsRecollect,a=configProps.sections,l=this.state.submittedAddress?React.createElement("div",null,configProps.frame_google()?null:history.pushState({id:"sections"},"",configProps.globals.path+"?p2"),React.createElement("div",{className:"g"},a.city_services.display?React.createElement(CityServices,{recollect_events:i,section:this.state.section,displaySection:this.displaySection}):null,a.city_spaces.display?React.createElement(CitySpaces,{library_branch:this.state.itemsDisplay.public_libraries_branch,library_address:this.state.itemsDisplay.public_libraries_address,library_zipcode:this.state.itemsDisplay.public_libraries_zipcode,comm_center:this.state.itemsDisplay.community_centers_name,comm_address:this.state.itemsDisplay.community_centers_address,comm_hours:this.state.itemsDisplay.community_centers_school_year_hours,comm_summer_hours:this.state.itemsDisplay.community_centers_summer_hours,park_name:this.state.itemsDisplay.parks_name,park_district:this.state.itemsDisplay.parks_district,park_ownership:this.state.itemsDisplay.parks_ownership,park_type:this.state.itemsDisplay.parks_type,hist_name:this.state.itemsDisplay.historic_districts_name,hist_place_name:this.state.itemsDisplay.historic_districts_place_name,hist_status:this.state.itemsDisplay.historic_districts_status,hist_year:this.state.itemsDisplay.historic_districts_year,hist_use_type:this.state.itemsDisplay.historic_districts_use_type,zoning_district:this.state.itemsDisplay.zoning_districts_district,section:this.state.section,displaySection:this.displaySection}):null,a.representation.display?React.createElement(Representation,{councilor:this.state.itemsDisplay.city_council_councilor,district:this.state.itemsDisplay.city_council_district,councilor_image:this.state.itemsDisplay.city_council_image,councilor_webpage:this.state.itemsDisplay.city_council_webpage,liason_name:this.state.itemsDisplay.ons_liaison_name,liason_image:this.state.itemsDisplay.ons_liaison_pic_url,liason_webpage:this.state.itemsDisplay.ons_liaison_webpage,liason_neighborhood:this.state.itemsDisplay.ons_liaison_neighborhood,voting_location:this.state.itemsDisplay.polling_locations_location2,voting_address:this.state.itemsDisplay.polling_locations_location3,early_voting_active:this.state.earlyVoting,early_voting_dates:this.state.itemsDisplay.early_voting_dates,early_voting_times:this.state.itemsDisplay.early_voting_times,early_voting_address:this.state.itemsDisplay.early_voting_address,early_voting_location:this.state.itemsDisplay.early_voting_location,early_voting_neighborhood:this.state.itemsDisplay.early_voting_neighborhood,early_voting_notes:this.state.itemsDisplay.early_voting_notes,ward:this.state.itemsDisplay.ward_name,precinct:this.state.itemsDisplay.precincts_name,section:this.state.section,displaySection:this.displaySection}):null,a.public_safety.display?React.createElement(PublicSafety,{police_station_name:this.state.itemsDisplay.police_dept_police_station,police_station_address:this.state.itemsDisplay.police_dept_address,police_station_neighborhood:this.state.itemsDisplay.police_dept_neighborhood,police_station_zip:this.state.itemsDisplay.police_dept_zip,police_district:this.state.itemsDisplay.police_district,fire_station_name:this.state.itemsDisplay.fire_dept_name,fire_station_address:this.state.itemsDisplay.fire_dept_address,fire_station_neighborhood:this.state.itemsDisplay.fire_dept_neighborhood,section:this.state.section,displaySection:this.displaySection}):null,a.summer.display?React.createElement(SummerResources,{tot_name:this.state.itemsDisplay.tot_sprays_name,tot_address:this.state.itemsDisplay.tot_sprays_address,bcyf_pool_center_name:this.state.itemsDisplay.bcyf_pool_centers_name,bcyf_pool_center_address:this.state.itemsDisplay.bcyf_pool_centers_address,bcyf_pool_center_hours:this.state.itemsDisplay.bcyf_pool_centers_school_year_hours,bcyf_pool_center_hours_summer:this.state.itemsDisplay.bcyf_pool_centers_summer_hours,section:this.state.section,displaySection:this.displaySection}):null,a.winter.display?React.createElement(WinterResources,{snow_routes:this.state.itemsDisplay.snow_routes_name,snow_routes_respsonsibility:this.state.itemsDisplay.snow_routes_responsibility,snow_parking_lots_name:this.state.itemsDisplay.snow_parking_lots_name,snow_parking_lots_address:this.state.itemsDisplay.snow_parking_lots_address,snow_parking_lots_fee:this.state.itemsDisplay.snow_parking_lots_fee,snow_parking_lots_comments:this.state.itemsDisplay.snow_parking_lots_comments,section:this.state.section,displaySection:this.displaySection}):null,a.newsletter.display?React.createElement(Newsletter,{section:this.state.section}):null,a.bos_311.display?React.createElement(Bos311,{section:this.state.section}):null)):"";return React.createElement("div",{className:"paragraphs-items paragraphs-items-field-components paragraphs-items-full paragraphs-items-field-components-full mnl"},React.createElement("div",null,React.createElement(Search,{handleKeywordChange:this.handleKeywordChange,handleKeywordSubmit:this.handleKeywordSubmit,placeholder:"Enter your address",searchClass:"sf-i-f",styleInline:{color:this.state.searchColor},currentKeywords:this.state.currentKeywords})),React.createElement("div",{style:{paddingTop:"50px"}},this.state.isLoading?React.createElement("div",{className:"supporting-text"},"Loading ... "):React.createElement("div",null,React.createElement("ul",{className:"dl"},s),React.createElement("div",null,l))))}}ReactDOM.render(React.createElement(MNL,null),document.getElementById("web-app"));