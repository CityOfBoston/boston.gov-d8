<project name="validate" default="validate:all">

  <!-- Run linter against all php files in repository. -->
  <target name="validate:lint" description="Runs a PHP Lint against all code.">
    <echo message="Using PHP 7 native linting to check for PHP compile errors." level="info"/>
    <phplint level="verbose" errorproperty="lint.error">
      <fileset refid="files.php"/>
    </phplint>
    <fail if="lint.error" message="PHP linting failed: ${lint.error}" status="1"/>
  </target>

  <!-- CODE BELOW IS NOT VERIFIED FOR D8 -->

  <!-- Run all validation targets. -->
  <target name="validate:all" description="Runs all code validation targets."
          depends="validate:lint, validate:phpcs"/>


  <!-- Run code sniffer against all custom code. -->
  <target name="validate:phpcs" description="Runs PHP Code Sniffer against only custom modules.">
    <property description="Defines a Drupal-specific PHP Ruleset."
              name="phpcs.ruleset"
              value="${repo.root}/vendor/drupal/coder/coder_sniffer/Drupal/ruleset.xml"/>

    <echo message="Using PHP CodeSniffer (Drupal ruleset) to check for coding standards conformity." level="info"/>

    <!-- Sniff custom modules for drupal coding standards compliance. -->
    <phpcodesniffer
            description="Sniff custom modules for Drupal coding standards compliance."
            standard="${phpcs.ruleset}"
            showSniffs="false"
            showWarnings="true"
            haltonerror="true"
            haltonwarning="true">
      <fileset refid="files.php" description="Use the PHP fileset def, but exclude PHP files on docroot." />
      <formatter type="full" usefile="false"/>
    </phpcodesniffer>

    <!-- Sniff JS and CSS in custom themes. -->

    <phpcodesniffer
        standard="${phpcs.ruleset}"
        showSniffs="false"
        showWarnings="true"
        haltonerror="true"
        haltonwarning="true">
      <fileset refid="files.php"/>
      <formatter type="full" usefile="false"/>
    </phpcodesniffer>


    <!-- Sniff tests for PSR2 coding standards compliance. -->
    <phpcodesniffer
        standard="${phpcs.ruleset}"
        showSniffs="false"
        showWarnings="true"
        haltonerror="true"
        haltonwarning="true">
      <fileset refid="files.php"/>
      <formatter type="full" usefile="false"/>
    </phpcodesniffer>
  </target>
</project>
